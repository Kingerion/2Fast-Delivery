<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#2196f3">
    <title>2Fast Delivery</title>
    
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; background: #f4f7f6; }
        
        /* LOGO HEADER */
        .app-header { background: white; padding: 15px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: relative; z-index: 20; }
        .app-header h1 { margin: 0; color: #333; font-size: 22px; font-weight: 800; }

        /* MAP */
        #map { height: 30vh; min-height: 200px; width: 100%; background: #e0e0e0; }
        
        .container { padding: 20px; max-width: 600px; margin: 0 auto; padding-bottom: 80px; }
        
        /* CARDS */
        .card { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .title { color: #888; font-weight: 600; font-size: 12px; text-transform: uppercase; margin-bottom: 15px; letter-spacing: 1px; }
        
        /* INPUTS */
        .input-group { margin-bottom: 15px; }
        input, textarea { width: 100%; padding: 14px; border: 1px solid #e0e0e0; border-radius: 8px; font-size: 15px; box-sizing: border-box; background: #fafafa; transition: 0.3s; font-family: inherit; }
        input:focus, textarea:focus { border-color: #2196f3; background: #fff; outline: none; }
        
        /* PRICE BOX */
        .price-box { background: #2196f3; color: white; padding: 20px; border-radius: 12px; text-align: center; margin-bottom: 20px; }
        .price-val { font-size: 32px; font-weight: 800; margin: 5px 0; }
        .price-dist { font-size: 14px; opacity: 0.9; }
        
        /* BUTTON */
        #sendBtn { width: 100%; padding: 18px; background: #000; color: white; border: none; border-radius: 30px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        #sendBtn:active { transform: scale(0.98); }
        #sendBtn:disabled { background: #ccc; cursor: not-allowed; }

        .row { display: flex; gap: 10px; }
        .row .input-group { flex: 1; }
    </style>
</head>
<body>

    <div class="app-header">
        <h1>2Fast Delivery</h1>
    </div>

    <div id="map"></div>

    <div class="container">
        
        <div class="card" style="margin-top: -20px; position: relative; z-index: 10;">
            <div class="title">ğŸ“ Î”Î™Î‘Î”Î¡ÎŸÎœÎ— (Î“Î¹Î± Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒ Î¤Î¹Î¼Î®Ï‚)</div>
            <div class="input-group">
                <input type="text" id="start" placeholder="Î‘Ï€ÏŒ: ÎŸÎ´ÏŒÏ‚ Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚..." onblur="calc()">
            </div>
            <div class="input-group">
                <input type="text" id="end" placeholder="Î ÏÎ¿Ï‚: ÎŸÎ´ÏŒÏ‚ Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚..." onblur="calc()">
            </div>
            
            <div class="price-box" id="priceBox">
                <div style="font-size: 12px; opacity: 0.8; text-transform: uppercase;">Î•ÎºÏ„Î¹Î¼Ï‰Î¼ÎµÎ½Î¿ ÎšÎ¿ÏƒÏ„Î¿Ï‚</div>
                <div class="price-val" id="priceDisplay">0.00 â‚¬</div>
                <div class="price-dist" id="distDisplay">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î´Î¹Î±Î´ÏÎ¿Î¼Î®</div>
            </div>
        </div>

        <div class="card">
            <div class="title">ğŸ“¦ Î£Î¤ÎŸÎ™Î§Î•Î™Î‘ Î Î‘Î¡Î‘Î›Î‘Î’Î—Î£ (Î‘Î ÎŸÎ£Î¤ÎŸÎ›Î•Î‘Î£)</div>
            <div class="input-group">
                <input type="text" id="pickupName" placeholder="ÎŸÎ½Î¿Î¼Î±Ï„ÎµÏ€ÏÎ½Ï…Î¼Î¿ Î® Î•Ï„Î±Î¹ÏÎµÎ¯Î±">
            </div>
            <div class="input-group">
                <input type="tel" id="pickupPhone" placeholder="Î¤Î·Î»Î­Ï†Ï‰Î½Î¿ Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î­Î±">
            </div>
            <div class="input-group">
                <input type="time" id="pickupTime" placeholder="ÎÏÎ± Î Î±ÏÎ±Î»Î±Î²Î®Ï‚">
                <small style="color: #888; font-size: 11px; margin-top: 4px; display: block;">*Î•Ï€Î¹Î¸Ï…Î¼Î·Ï„Î® ÏÏÎ± Ï€Î±ÏÎ±Î»Î±Î²Î®Ï‚</small>
            </div>
        </div>

        <div class="card">
            <div class="title">ğŸ  Î£Î¤ÎŸÎ™Î§Î•Î™Î‘ Î Î‘Î¡Î‘Î”ÎŸÎ£Î—Î£ (Î Î‘Î¡Î‘Î›Î—Î Î¤Î—Î£)</div>
            <div class="input-group">
                <input type="text" id="deliveryName" placeholder="ÎŸÎ½Î¿Î¼Î±Ï„ÎµÏ€ÏÎ½Ï…Î¼Î¿ Î Î±ÏÎ±Î»Î®Ï€Ï„Î·">
            </div>
            <div class="input-group">
                <input type="tel" id="deliveryPhone" placeholder="Î¤Î·Î»Î­Ï†Ï‰Î½Î¿ Î Î±ÏÎ±Î»Î®Ï€Ï„Î·">
            </div>
            <div class="input-group">
                <input type="email" id="deliveryEmail" placeholder="Email Î Î±ÏÎ±Î»Î®Ï€Ï„Î· (Î ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ)">
            </div>
            <div class="row">
                <div class="input-group">
                    <input type="date" id="deliveryDate">
                </div>
                <div class="input-group">
                    <input type="time" id="deliveryTime">
                </div>
            </div>
            <div class="input-group">
                <textarea id="deliveryNote" rows="2" placeholder="Î£Ï‡ÏŒÎ»Î¹Î± Î Î±ÏÎ¬Î´Î¿ÏƒÎ·Ï‚ (Ï€.Ï‡. ÎŒÏÎ¿Ï†Î¿Ï‚, ÎšÎ¿Ï…Î´Î¿ÏÎ½Î¹)"></textarea>
            </div>
            <div class="input-group">
                <input type="number" id="deliveryTips" placeholder="Î¦Î¹Î»Î¿Î´ÏÏÎ·Î¼Î± (â‚¬) - Î ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ">
            </div>
        </div>

        <button id="sendBtn" onclick="submitOrder()">Checkout (Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®)</button>

    </div>

    <script>
        // --- Î¡Î¥Î˜ÎœÎ™Î£Î•Î™Î£ Î§Î‘Î¡Î¤Î— & Î¤Î™ÎœÎ—Î£ ---
        const MAX_KM = 35;
        let map, dirService, dirRenderer, startAuto, endAuto;
        let calculatedPrice = 0;

        // Î’Î‘Î›Î• Î•Î”Î© Î¤ÎŸ LINK Î¤ÎŸÎ¥ GOOGLE SCRIPT Î£ÎŸÎ¥!
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyUiDbvjt55A2pP3AYTHqlV5NPD3f1pMAcooOY5hf8ICZHFB15pztup3ySuk38u6R2ckQ/exec";

        function initMap() {
            try {
                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 13, center: { lat: 37.9429, lng: 23.6470 }, disableDefaultUI: true
                });
                dirService = new google.maps.DirectionsService();
                dirRenderer = new google.maps.DirectionsRenderer({ map: map, polylineOptions: { strokeColor: "#2196f3", strokeWeight: 5 }});
                initAuto();
            } catch (e) { console.error("Map Error:", e); }
        }

        function initAuto() {
            const opts = { componentRestrictions: { country: "gr" }, fields: ["geometry", "name"] };
            startAuto = new google.maps.places.Autocomplete(document.getElementById('start'), opts);
            endAuto = new google.maps.places.Autocomplete(document.getElementById('end'), opts);
            startAuto.addListener("place_changed", calc);
            endAuto.addListener("place_changed", calc);
        }

        function calc() {
            const start = document.getElementById('start').value;
            const end = document.getElementById('end').value;
            
            if (start.length > 3 && end.length > 3) {
                dirService.route({ origin: start, destination: end, travelMode: 'DRIVING' }, (res, status) => {
                    if (status === 'OK') {
                        dirRenderer.setDirections(res);
                        const km = res.routes[0].legs[0].distance.value / 1000;
                        const txt = res.routes[0].legs[0].distance.text;

                        if (km > MAX_KM) {
                            document.getElementById('priceDisplay').innerText = "ğŸš«";
                            document.getElementById('distDisplay').innerText = "Î•ÎºÏ„ÏŒÏ‚ Î ÎµÏÎ¹Î¿Ï‡Î®Ï‚";
                            calculatedPrice = 0;
                            return;
                        }

                        // Î¤Î¥Î ÎŸÎ£ Î¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸÎ¥ Î¤Î™ÎœÎ—Î£ (3â‚¬ Ï„Î± Ï€ÏÏÏ„Î± 500Î¼, Î¼ÎµÏ„Î¬ 0.50â‚¬/Ï‡Î»Î¼ ÎºÎ»Ï€)
                        let price = 3.00;
                        if (km > 0.5) {
                            let rem = km - 0.5;
                            if (rem <= 3.5) price += rem * 0.50;
                            else {
                                price += 3.5 * 0.50; 
                                rem -= 3.5;
                                let rate = 0.60;
                                while(rem > 0) { price += (rem>=1?1:rem)*rate; rem--; rate+=0.10; }
                            }
                        }
                        
                        calculatedPrice = price.toFixed(2);
                        document.getElementById('priceDisplay').innerText = calculatedPrice + " â‚¬";
                        document.getElementById('distDisplay').innerText = txt + " â€¢ ~" + res.routes[0].legs[0].duration.text;
                    }
                });
            }
        }

        // --- Î‘Î ÎŸÎ£Î¤ÎŸÎ›Î— Î Î‘Î¡Î‘Î“Î“Î•Î›Î™Î‘Î£ ---
        function submitOrder() {
            if (calculatedPrice == 0) {
                alert("Î Î±ÏÎ±ÎºÎ±Î»Ï ÏƒÏ…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ Ï€Î±ÏÎ±Î»Î±Î²Î®Ï‚ ÎºÎ±Î¹ Ï€Î±ÏÎ¬Î´Î¿ÏƒÎ·Ï‚ Î³Î¹Î± Î½Î± Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„ÎµÎ¯ Ï„Î¿ ÎºÏŒÏƒÏ„Î¿Ï‚.");
                return;
            }

            const btn = document.getElementById('sendBtn');
            btn.innerText = "Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®... â³";
            btn.disabled = true;

            // Î£Ï…Î³ÎºÎ­Î½Ï„ÏÏ‰ÏƒÎ· Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î±Ï€ÏŒ Ï„Î· Î¦ÏŒÏÎ¼Î±
            const payload = {
                startAddr: document.getElementById('start').value,
                endAddr: document.getElementById('end').value,
                price: calculatedPrice,
                
                pickupName: document.getElementById('pickupName').value,
                pickupPhone: document.getElementById('pickupPhone').value,
                pickupTime: document.getElementById('pickupTime').value,
                
                deliveryName: document.getElementById('deliveryName').value,
                deliveryPhone: document.getElementById('deliveryPhone').value,
                deliveryEmail: document.getElementById('deliveryEmail').value,
                deliveryDate: document.getElementById('deliveryDate').value,
                deliveryTime: document.getElementById('deliveryTime').value,
                
                notes: document.getElementById('deliveryNote').value,
                tips: document.getElementById('deliveryTips').value || 0
            };

            // Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î® ÏƒÏ„Î¿ Google Script
            fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify(payload)
            })
            .then(response => response.text())
            .then(data => {
                console.log(data);
                if(data.includes("Success")) {
                    alert("âœ… Î— Ï€Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î± ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ®Î¸Î·ÎºÎµ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!");
                    window.location.reload();
                } else {
                    alert("âš ï¸ Î¥Ï€Î®ÏÎ¾Îµ Î­Î½Î± Ï€ÏÏŒÎ²Î»Î·Î¼Î± (Shipday Error): " + data);
                    btn.innerText = "Checkout (Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®)";
                    btn.disabled = false;
                }
            })
            .catch(error => {
                alert("âŒ Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚: " + error);
                btn.innerText = "Checkout (Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®)";
                btn.disabled = false;
            });
        }
    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAdeWVPf1-3ZObret2Onsjb6_DldLgaQCw&libraries=places&callback=initMap" async defer></script>

</body>
</html>
