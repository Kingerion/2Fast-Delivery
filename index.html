<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="theme-color" content="#2196f3" />
  <title>2Fast Delivery</title>

  <!-- OPTION A: Î’Î¬Î»Îµ ÎµÎ´Ï key (ÎŸÎ§Î™ Ï€ÏÎ¿Ï„ÎµÎ¹Î½ÏŒÎ¼ÎµÎ½Î¿ ÏƒÎµ public page) -->
  <!-- <meta name="gmaps-key" content="PASTE_KEY_HERE"> -->

  <style>
    body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; background: #f8f9fa; }
    #map { height: 40vh; min-height: 250px; width: 100%; background: #e0e0e0; border-radius: 0 0 20px 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    .container { padding: 20px; max-width: 600px; margin: -25px auto 0; position: relative; z-index: 10; padding-bottom: 80px; }

    .header-row { display: flex; justify-content: space-between; align-items: center; margin: 10px 0 20px; }
    h2 { color: #333; font-size: 22px; font-weight: 800; margin: 0; }
    .reset-btn { background: #ffebee; color: #d32f2f; border: none; padding: 8px 12px; border-radius: 8px; font-weight: bold; font-size: 13px; cursor: pointer; }

    .card { background: white; padding: 15px; border-radius: 16px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .title { color: #1976d2; font-weight: 800; font-size: 13px; text-transform: uppercase; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }

    input, select, textarea {
      width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px;
      font-size: 16px; box-sizing: border-box; background: #f9f9f9; margin-bottom: 8px; transition: 0.2s;
    }
    input:focus, textarea:focus, select:focus { border-color: #2196f3; background: #fff; outline: none; }

    .error { border-color: #ff3b30 !important; background: #fff0f0 !important; animation: shake 0.3s; }
    @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 100% { transform: translateX(0); } }

    .row { display: flex; gap: 10px; }
    .col-8 { flex: 2; } .col-4 { flex: 1; } .col-6 { flex: 1; }

    .btn-group { display: flex; gap: 10px; margin-bottom: 10px; }
    .toggle-btn { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px; background: white; font-weight: 600; color: #555; cursor: pointer; }
    .toggle-btn.active { background: #e3f2fd; border-color: #2196f3; color: #1976d2; }

    .switch-wrap { display: flex; justify-content: space-between; align-items: center; background: #fff3e0; padding: 10px 15px; border-radius: 10px; margin-bottom: 10px; border: 1px solid #ffe0b2; cursor: pointer; }
    .switch-label { font-weight: bold; color: #f57c00; font-size: 15px; }
    .switch { position: relative; display: inline-block; width: 46px; height: 26px; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; inset: 0; background-color: #ccc; transition: .3s; border-radius: 34px; }
    .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; transition: .3s; border-radius: 50%; }
    input:checked + .slider { background-color: #f57c00; }
    input:checked + .slider:before { transform: translateX(20px); }

    .price-box { background: linear-gradient(135deg, #1e88e5, #1565c0); color: white; padding: 20px; border-radius: 16px; text-align: center; margin: 20px 0; box-shadow: 0 5px 15px rgba(21, 101, 192, 0.3); }
    .price-val { font-size: 36px; font-weight: 800; }
    .price-dist { opacity: 0.9; font-size: 14px; margin-top: 5px; }

    #sendBtn { width: 100%; padding: 16px; background: #ff5722; color: white; border: none; border-radius: 12px; font-size: 18px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(255, 87, 34, 0.3); transition: 0.2s; }
    #sendBtn:disabled { background: #ccc; box-shadow: none; cursor: not-allowed; }

    #successModal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center; }
    .modal-box { background: white; padding: 30px; border-radius: 20px; text-align: center; width: 80%; max-width: 320px; animation: pop 0.25s; }
    .tick { font-size: 50px; color: #4CAF50; display: block; margin-bottom: 10px; }
    @keyframes pop { from{transform:scale(0.9)} to{transform:scale(1)} }

    .hint { text-align:center; font-size: 13px; color: #2e7d32; font-weight: 700; }
  </style>
</head>
<body>

  <div id="map"></div>

  <div class="container">
    <div class="header-row">
      <h2>Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î® Î”Î­Î¼Î±Ï„Î¿Ï‚</h2>
      <button class="reset-btn" id="resetBtn" type="button">ğŸ—‘ï¸ ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚</button>
    </div>

    <input type="tel" id="phone" placeholder="Î¤Î¿ Î¤Î·Î»Î­Ï†Ï‰Î½ÏŒ ÏƒÎ±Ï‚ (69...)" inputmode="tel"
           style="padding: 16px; font-size: 18px; font-weight: bold; text-align: center; margin-bottom: 20px;">

    <div class="card">
      <div class="title">ğŸ•’ Î§Î¡ÎŸÎÎŸÎ£</div>
      <div class="btn-group">
        <button class="toggle-btn active" id="btnNow" type="button">âš¡ Î¤ÏÏÎ±</button>
        <button class="toggle-btn" id="btnLater" type="button">ğŸ“… Î¡Î±Î½Ï„ÎµÎ²Î¿Ï</button>
      </div>
      <div id="nowInfo" class="hint">ğŸš€ Î†Ï†Î¹Î¾Î· ÏƒÎµ ~30'</div>
      <input type="datetime-local" id="scheduleTime" style="display:none;">
    </div>

    <div class="card">
      <div class="title">ğŸ“ Î Î‘Î¡Î‘Î›Î‘Î’Î—</div>
      <input type="text" id="start" placeholder="ğŸ” ÎŸÎ´ÏŒÏ‚ Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚...">
      <div class="row">
        <div class="col-8"><input type="text" id="startName" placeholder="ÎŒÎ½Î¿Î¼Î±/ÎšÎ¿Ï…Î´Î¿ÏÎ½Î¹ (Î¥Ï€Î¿Ï‡ÏÎµÏ‰Ï„Î¹ÎºÏŒ)"></div>
        <div class="col-4"><input type="number" id="startFloor" placeholder="ÎŒÏÎ¿Ï†Î¿Ï‚" inputmode="numeric" min="0"></div>
      </div>
    </div>

    <div class="card">
      <div class="title">ğŸ Î Î‘Î¡Î‘Î”ÎŸÎ£Î—</div>
      <input type="text" id="end" placeholder="ğŸ” ÎŸÎ´ÏŒÏ‚ Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚...">
      <div class="row">
        <div class="col-8"><input type="text" id="endName" placeholder="ÎŒÎ½Î¿Î¼Î±/ÎšÎ¿Ï…Î´Î¿ÏÎ½Î¹ (Î¥Ï€Î¿Ï‡ÏÎµÏ‰Ï„Î¹ÎºÏŒ)"></div>
        <div class="col-4"><input type="number" id="endFloor" placeholder="ÎŒÏÎ¿Ï†Î¿Ï‚" inputmode="numeric" min="0"></div>
      </div>
      <input type="tel" id="endPhone" placeholder="ğŸ“ Î¤Î·Î»Î­Ï†Ï‰Î½Î¿ Î Î±ÏÎ±Î»Î®Ï€Ï„Î·" inputmode="tel" style="border-left: 4px solid #ff9800;">
    </div>

    <div class="card">
      <div class="title">ğŸ“¦ Î›Î•Î Î¤ÎŸÎœÎ•Î¡Î•Î™Î•Î£</div>
      <div class="switch-wrap" id="roundTripWrap">
        <span class="switch-label">ğŸ”„ ÎœÎµ Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î® (x2)</span>
        <label class="switch">
          <input type="checkbox" id="roundTrip">
          <span class="slider"></span>
        </label>
      </div>
      <div class="row">
        <div class="col-6">
          <select id="parcel">
            <option>Î¦Î¬ÎºÎµÎ»Î¿Ï‚</option>
            <option>ÎœÎ¹ÎºÏÏŒ Î”Î­Î¼Î±</option>
            <option>ÎœÎµÎ³Î¬Î»Î¿ Î”Î­Î¼Î±</option>
          </select>
        </div>
        <div class="col-6">
          <select id="payment">
            <option>ÎœÎµÏ„ÏÎ·Ï„Î¬</option>
            <option>POS</option>
            <option>Iris</option>
          </select>
        </div>
      </div>
      <textarea id="notes" placeholder="Î£Ï‡ÏŒÎ»Î¹Î± / ÎŸÎ´Î·Î³Î¯ÎµÏ‚..." style="height: 60px;"></textarea>
    </div>

    <div class="price-box" id="priceBox">
      <div style="font-size: 13px; opacity: 0.8;">Î•ÎšÎ¤Î™ÎœÎ©ÎœÎ•ÎÎŸ ÎšÎŸÎ£Î¤ÎŸÎ£</div>
      <div class="price-val" id="priceDisplay">0.00 â‚¬</div>
      <div class="price-dist" id="distDisplay">-</div>
    </div>

    <button id="sendBtn" type="button">Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î® Î Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±Ï‚</button>
  </div>

  <div id="successModal" role="dialog" aria-modal="true">
    <div class="modal-box">
      <span class="tick">âœ”</span>
      <h3>ÎˆÏ„Î¿Î¹Î¼Î¿!</h3>
      <p>Î— Ï€Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î± ÎµÏƒÏ„Î¬Î»Î·.</p>
      <button id="newOrderBtn"
              type="button"
              style="padding:10px 20px; border:none; background:#2196f3; color:white; border-radius:8px; width: 100%; margin-top: 10px;">
        ÎÎ­Î± Î Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±
      </button>
    </div>
  </div>

  <script>
    // ----------------- Î¡Î¥Î˜ÎœÎ™Î£Î•Î™Î£ -----------------
    const MY_PHONE = "306934021792";
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz_XXXXXXXXXXXX/exec";
    const MAX_KM = 35;

    // Î’Î¬Î»Îµ Ï„Î± defaults ÏƒÎ¿Ï… ÎµÎ´Ï
    const BASE_PRICE = 3.00;
    const FIRST_KM_FREE = 1.0;
    // ------------------------------------------------

    let map, dirService, dirRenderer, startAuto, endAuto;
    let calculatedPrice = 0, distanceTxt = "", durationTxt = "";
    let timeMode = "now";
    let calcTimer = null;

    const el = (id) => document.getElementById(id);

    function setMinScheduleTime() {
      // datetime-local Ï€ÎµÏÎ¹Î¼Î­Î½ÎµÎ¹ "YYYY-MM-DDTHH:MM"
      const now = new Date();
      now.setMinutes(now.getMinutes() + 10); // +10' buffer
      const pad = (n) => String(n).padStart(2, "0");
      const v = `${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())}T${pad(now.getHours())}:${pad(now.getMinutes())}`;
      el("scheduleTime").min = v;
    }

    window.onload = function() {
      const saved = localStorage.getItem("phone");
      if (saved) el("phone").value = saved;

      setMinScheduleTime();

      // Events
      el("resetBtn").addEventListener("click", resetForm);
      el("sendBtn").addEventListener("click", send);
      el("btnNow").addEventListener("click", () => setMode("now"));
      el("btnLater").addEventListener("click", () => setMode("later"));

      el("roundTripWrap").addEventListener("click", (e) => {
        // Î³Î¹Î± Î½Î± Î¼Î·Î½ â€œÎ´Î¹Ï€Î»Î¿-ÎºÎ»Î¹ÎºÎ¬ÏÎµÎ¹â€ ÏŒÏ„Î±Î½ Ï€Î±Ï„Î¬Ï‚ Ï€Î¬Î½Ï‰ ÏƒÏ„Î¿ checkbox
        if (e.target.tagName.toLowerCase() === "input") return;
        el("roundTrip").checked = !el("roundTrip").checked;
        scheduleCalc();
      });
      el("roundTrip").addEventListener("change", scheduleCalc);

      ["start","end"].forEach(id => {
        el(id).addEventListener("blur", scheduleCalc);
        el(id).addEventListener("input", scheduleCalc);
      });
    };

    window.gm_authFailure = function() {
      alert("âš ï¸ Î£Î¦Î‘Î›ÎœÎ‘ GOOGLE MAPS!\nÎ¤Î¿ ÎºÎ»ÎµÎ¹Î´Î¯ API Î´ÎµÎ½ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Î® Î´ÎµÎ½ Î­Ï‡ÎµÎ¹ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î±.");
    };

    function initMap() {
      try {
        map = new google.maps.Map(el("map"), {
          zoom: 13,
          center: { lat: 37.9429, lng: 23.6470 },
          disableDefaultUI: true
        });
        dirService = new google.maps.DirectionsService();
        dirRenderer = new google.maps.DirectionsRenderer({
          map: map,
          polylineOptions: { strokeColor: "#2196f3", strokeWeight: 5 },
          suppressMarkers: false
        });
        initAuto();

        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            pos => map.setCenter({ lat: pos.coords.latitude, lng: pos.coords.longitude }),
            () => {}
          );
        }
      } catch (e) {
        console.error("Map Error:", e);
      }
    }

    function initAuto() {
      const opts = { componentRestrictions: { country: "gr" }, fields: ["geometry", "name", "formatted_address"] };
      startAuto = new google.maps.places.Autocomplete(el("start"), opts);
      endAuto = new google.maps.places.Autocomplete(el("end"), opts);

      startAuto.bindTo("bounds", map);
      endAuto.bindTo("bounds", map);

      startAuto.addListener("place_changed", scheduleCalc);
      endAuto.addListener("place_changed", scheduleCalc);
    }

    function scheduleCalc() {
      // debounce Î³Î¹Î± Î½Î± Î¼Î· ÎºÎ¬Î½ÎµÎ¹ spam ÏƒÏ„Î¿ Directions API
      if (calcTimer) clearTimeout(calcTimer);
      calcTimer = setTimeout(calc, 450);
    }

    function setPriceError(msg) {
      el("priceDisplay").innerText = "ğŸš«";
      el("distDisplay").innerText = msg;
      el("priceBox").style.background = "#d32f2f";
      el("sendBtn").disabled = true;
      calculatedPrice = 0;
    }

    function resetPriceUI() {
      el("priceBox").style.background = "linear-gradient(135deg, #1e88e5, #1565c0)";
      el("sendBtn").disabled = false;
    }

    function calc() {
      const start = el("start").value.trim();
      const end = el("end").value.trim();

      resetPriceUI();

      if (start.length <= 3 || end.length <= 3) return;

      dirService.route(
        { origin: start, destination: end, travelMode: "DRIVING" },
        (res, status) => {
          if (status !== "OK" || !res?.routes?.[0]?.legs?.[0]) {
            console.warn("Directions status:", status);
            setPriceError(status === "ZERO_RESULTS" ? "Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Î´Î¹Î±Î´ÏÎ¿Î¼Î®." : "Î ÏÏŒÎ²Î»Î·Î¼Î± Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Ï Î´Î¹Î±Î´ÏÎ¿Î¼Î®Ï‚.");
            return;
          }

          dirRenderer.setDirections(res);

          const bounds = res.routes[0].bounds;
          map.fitBounds(bounds, { bottom: 100, left: 20, right: 20, top: 20 });

          const leg = res.routes[0].legs[0];
          const km = leg.distance.value / 1000;
          distanceTxt = leg.distance.text;
          durationTxt = leg.duration.text;

          if (km > MAX_KM) {
            setPriceError(`Î•ÎºÏ„ÏŒÏ‚ Î ÎµÏÎ¹Î¿Ï‡Î®Ï‚ (> ${MAX_KM}km)`);
            return;
          }

          // Pricing
          let price = BASE_PRICE;

          if (km > FIRST_KM_FREE) {
            let rem = km - FIRST_KM_FREE;

            // 1-4km: 0.50/Ï‡Î»Î¼ (Î³Î¹Î± Ï„Î± ÎµÏ€ÏŒÎ¼ÎµÎ½Î± 3km)
            if (rem <= 3) {
              price += rem * 0.50;
            } else {
              price += 1.50; // 3km * 0.50
              rem -= 3;

              // Î¼ÎµÏ„Î¬ ÎºÎ»Î¹Î¼Î±ÎºÏ‰Ï„Î¬ 0.60, 0.70, 0.80...
              let rate = 0.60;
              while (rem > 0) {
                const chunk = rem >= 1 ? 1 : rem;
                price += chunk * rate;
                rem -= chunk;
                rate += 0.10;
              }
            }
          }

          if (el("roundTrip").checked) price *= 2.0;

          calculatedPrice = price;
          el("priceDisplay").innerText = price.toFixed(2) + " â‚¬";
          el("distDisplay").innerText = `${distanceTxt} â€¢ ~${durationTxt}`;
        }
      );
    }

    function setMode(m) {
      timeMode = m;
      el("btnNow").className = m === "now" ? "toggle-btn active" : "toggle-btn";
      el("btnLater").className = m === "later" ? "toggle-btn active" : "toggle-btn";
      el("nowInfo").style.display = m === "now" ? "block" : "none";
      el("scheduleTime").style.display = m === "later" ? "block" : "none";
      if (m === "later") setMinScheduleTime();
    }

    function resetForm() {
      const savedPhone = el("phone").value.trim();

      const inputs = document.querySelectorAll("input:not(#phone), textarea");
      inputs.forEach(i => i.value = "");

      el("phone").value = savedPhone;

      el("roundTrip").checked = false;
      el("parcel").selectedIndex = 0;
      el("payment").selectedIndex = 0;
      setMode("now");

      calculatedPrice = 0;
      distanceTxt = "";
      durationTxt = "";
      el("priceDisplay").innerText = "0.00 â‚¬";
      el("distDisplay").innerText = "-";
      resetPriceUI();
      el("sendBtn").innerText = "Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î® Î Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±Ï‚";
      el("sendBtn").disabled = false;

      if (dirRenderer) dirRenderer.setDirections({ routes: [] });
    }

    function markError(element) {
      element.classList.add("error");
      setTimeout(() => element.classList.remove("error"), 1800);
    }

    function normalizeGRPhone(v) {
      // ÎºÏÎ±Ï„Î¬ Î¼ÏŒÎ½Î¿ ÏˆÎ·Ï†Î¯Î±, ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ 69xxxxxxxx Î® 2xxxxxxxxx Î® +30...
      const digits = (v || "").replace(/\D/g, "");
      // Î±Î½ Î¾ÎµÎºÎ¹Î½Î¬ Î¼Îµ 30 ÎºÎ±Î¹ Î­Ï‡ÎµÎ¹ 12, ÎºÏÎ¬Ï„Î± Ï„Î± Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± 10 Î³Î¹Î± Î­Î»ÎµÎ³Ï‡Î¿
      const local = digits.startsWith("30") ? digits.slice(2) : digits;
      return { digits, local };
    }

    function validateRequired(id) {
      const element = el(id);
      if (!element.value.trim()) {
        markError(element);
        element.scrollIntoView({ behavior: "smooth", block: "center" });
        return false;
      }
      return true;
    }

    function send() {
      let ok = true;

      // required
      ok = validateRequired("phone") && ok;
      ok = validateRequired("start") && ok;
      ok = validateRequired("startName") && ok;
      ok = validateRequired("end") && ok;
      ok = validateRequired("endName") && ok;

      if (!ok) return;

      // phone validation (ÎµÎ½Ï„Î¿Î»Î­Î±Ï‚)
      const p = normalizeGRPhone(el("phone").value);
      const phoneOk = (p.local.length === 10 && (p.local.startsWith("69") || p.local.startsWith("2")));
      if (!phoneOk) {
        alert("âš ï¸ Î’Î¬Î»Îµ ÏƒÏ‰ÏƒÏ„ÏŒ Ï„Î·Î»Î­Ï†Ï‰Î½Î¿ (Ï€.Ï‡. 69xxxxxxxx Î® ÏƒÏ„Î±Î¸ÎµÏÏŒ 2xxxxxxxxx).");
        markError(el("phone"));
        el("phone").scrollIntoView({ behavior: "smooth", block: "center" });
        return;
      }

      // schedule validation
      let timeStr = "âš¡ Î‘ÎœÎ•Î£Î‘";
      if (timeMode === "later") {
        const t = el("scheduleTime").value;
        if (!t) {
          alert("âš ï¸ Î•Ï€Î¹Î»Î­Î¾Ï„Îµ ÏÏÎ± ÏÎ±Î½Ï„ÎµÎ²Î¿Ï!");
          markError(el("scheduleTime"));
          el("scheduleTime").scrollIntoView({ behavior: "smooth", block: "center" });
          return;
        }
        timeStr = "ğŸ“… " + t.replace("T", " ");
      }

      if (calculatedPrice === 0) {
        alert("âš ï¸ Î ÏÏŒÎ²Î»Î·Î¼Î± Î´Î¹Î±Î´ÏÎ¿Î¼Î®Ï‚! Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ ÏƒÏ‰ÏƒÏ„Î¬ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ ÎºÎ±Î¹ Ï€ÎµÏÎ¯Î¼ÎµÎ½Îµ Î½Î± Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„ÎµÎ¯ Î· Ï„Î¹Î¼Î®.");
        return;
      }

      const phone = p.digits.startsWith("30") ? p.digits : ("30" + p.local);
      localStorage.setItem("phone", el("phone").value.trim());

      const startAddr = el("start").value.trim();
      const startName = el("startName").value.trim();
      const startFloor = el("startFloor").value.trim() || "-";

      const endAddr = el("end").value.trim();
      const endName = el("endName").value.trim();
      const endFloor = el("endFloor").value.trim() || "-";
      const endPhoneRaw = el("endPhone").value.trim();
      const endPhone = endPhoneRaw ? endPhoneRaw : "-";

      const parcel = el("parcel").value;
      const payment = el("payment").value;
      const comments = el("notes").value.trim();
      const isRoundTrip = el("roundTrip").checked;

      // WhatsApp message
      let waMsg = `*ÎÎ­Î± Î Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î± 2Fast!* ğŸš€\n`;
      waMsg += `â° *${timeStr}*` + (isRoundTrip ? " | ğŸ”„ *ÎœÎµ Î•Ï€Î¹ÏƒÏ„ÏÎ¿Ï†Î®*" : "") + `\n\n`;
      waMsg += `ğŸ“ *Î•Î½Ï„Î¿Î»Î­Î±Ï‚:* ${el("phone").value.trim()}\n`;
      waMsg += `--------------------------------\n`;
      waMsg += `ğŸ“ *Î‘Î ÎŸ:* ${startAddr}\n`;
      waMsg += `      ğŸ”” ${startName} | ğŸ¢ ${startFloor}\n\n`;
      waMsg += `ğŸ *Î Î¡ÎŸÎ£:* ${endAddr}\n`;
      waMsg += `      ğŸ”” ${endName} | ğŸ¢ ${endFloor}\n`;
      waMsg += `      ğŸ“ ${endPhone}\n`;
      waMsg += `--------------------------------\n`;
      waMsg += `ğŸ“¦ *Î”Î­Î¼Î±:* ${parcel}\n`;
      waMsg += `ğŸ’³ *Î Î»Î·ÏÏ‰Î¼Î®:* ${payment}\n`;
      if (comments) waMsg += `ğŸ“ *Î£Ï‡ÏŒÎ»Î¹Î±:* ${comments}\n`;
      waMsg += `\nğŸ’° *Î¤Î•Î›Î™ÎšÎŸ ÎšÎŸÎ£Î¤ÎŸÎ£: ${calculatedPrice.toFixed(2)} â‚¬*`;

      // Î‘Î½Î¿Î¯Î³ÎµÎ¹ WhatsApp
      window.open("https://wa.me/" + MY_PHONE + "?text=" + encodeURIComponent(waMsg), "_blank");

      // Shipday payload (Apps Script)
      const fullStart = `${startAddr} (ğŸ”” ${startName}, ğŸ¢ ${startFloor})`;
      const fullEnd = `${endAddr} (ğŸ”” ${endName}, ğŸ¢ ${endFloor})`;
      const fullNotes =
        `Î©Î¡Î‘: ${timeStr} | Î•Î Î™Î£Î¤Î¡ÎŸÎ¦Î—: ${isRoundTrip ? "ÎÎ‘Î™" : "ÎŸÎ§Î™"} | ` +
        `Î Î‘Î¡Î‘Î›Î—Î Î¤Î—Î£: ${endPhone} | Î”Î•ÎœÎ‘: ${parcel} | Î Î›Î—Î¡Î©ÎœÎ—: ${payment} | ` +
        `Î£Î§ÎŸÎ›Î™Î‘: ${comments || "-"}`;

      el("sendBtn").innerText = "Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®...";
      el("sendBtn").disabled = true;

      fetch(SCRIPT_URL, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          phone,
          start: fullStart,
          end: fullEnd,
          comments: fullNotes,
          price: calculatedPrice.toFixed(2),
          dist: distanceTxt,
          duration: durationTxt
        })
      })
      .then(() => {
        showSuccess();
      })
      .catch((e) => {
        alert("Î£Ï†Î¬Î»Î¼Î± Î±Ï€Î¿ÏƒÏ„Î¿Î»Î®Ï‚: " + e);
        el("sendBtn").disabled = false;
        el("sendBtn").innerText = "Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î® Î Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±Ï‚";
      });
    }

    function showSuccess() {
      const modal = el("successModal");
