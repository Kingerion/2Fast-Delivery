<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2Fast Delivery | Online Î Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±</title>
    <style>
        :root { --primary: #FF5722; --secondary: #1E293B; --bg: #F1F5F9; --card: #FFFFFF; --text: #334155; --border: #E2E8F0; }
        body { margin: 0; font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); }
        .app-header { background: var(--secondary); padding: 15px; text-align: center; }
        .app-header img { max-height: 50px; }
        #map { height: 32vh; min-height: 220px; width: 100%; background: #e0e0e0; }
        .container { padding: 15px; max-width: 600px; margin: 0 auto; padding-bottom: 40px; }
        .card { background: var(--card); padding: 20px; border-radius: 16px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); }
        .title { color: var(--secondary); font-weight: 800; font-size: 14px; text-transform: uppercase; margin-bottom: 15px; }
        .input-group { margin-bottom: 15px; }
        input, textarea, select { width: 100%; padding: 15px; border: 2px solid var(--border); border-radius: 10px; font-size: 15px; box-sizing: border-box; background: #F8FAFC; }
        .price-box { background: #1E293B; color: white; padding: 25px; border-radius: 16px; text-align: center; margin-bottom: 20px; }
        .price-val { font-size: 42px; font-weight: 900; margin: 5px 0; }
        #sendBtn { width: 100%; padding: 20px; background: var(--primary); color: white; border: none; border-radius: 14px; font-size: 18px; font-weight: bold; cursor: pointer; }
        .row { display: flex; gap: 12px; } .row .input-group { flex: 1; margin-bottom: 0; }
        .support-fab { position: fixed; bottom: 20px; right: 20px; background: var(--secondary); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 28px; z-index: 1000; }
        .support-menu { position: fixed; bottom: 90px; right: 20px; display: none; flex-direction: column; gap: 10px; z-index: 1000; }
        .support-menu.active { display: flex; }
        .support-item { background: white; padding: 12px 20px; border-radius: 30px; font-weight: bold; text-decoration: none; color: var(--text); border: 1px solid var(--border); }
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(30,41,59,0.7); }
        .modal-content { background: var(--card); margin: 5vh auto; padding: 30px; border-radius: 16px; width: 90%; max-width: 650px; max-height: 85vh; overflow-y: auto; position: relative; }
        .close-modal { position: absolute; top: 15px; right: 20px; font-size: 30px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="app-header">
        <img src="https://via.placeholder.com/300x80/1E293B/FFFFFF?text=2Fast+Delivery" alt="2Fast Delivery Logo">
    </div>
    <div id="map"></div>

    <div class="container">
        <div class="card" style="margin-top: -30px; position: relative; z-index: 10;">
            <div class="title">ğŸ“ Î£Î·Î¼ÎµÎ¯Î± Î”Î¹Î±Î´ÏÎ¿Î¼Î®Ï‚</div>
            <div class="input-group"><input type="text" id="start" placeholder="Î‘Ï€ÏŒ: ÎŸÎ´ÏŒÏ‚, Î ÎµÏÎ¹Î¿Ï‡Î®" onblur="calc()"></div>
            <div class="input-group"><input type="text" id="end" placeholder="Î ÏÎ¿Ï‚: ÎŸÎ´ÏŒÏ‚, Î ÎµÏÎ¹Î¿Ï‡Î®" onblur="calc()"></div>
            <div class="price-box">
                <div style="font-size: 12px; font-weight: bold;">ÎšÎ¿ÏƒÏ„Î¿Ï‚ Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î·Ï‚</div>
                <div class="price-val" id="priceDisplay">0.00 â‚¬</div>
                <div id="distDisplay">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ ÏƒÏ„Î¿ Ï‡Î¬ÏÏ„Î·</div>
            </div>
        </div>

        <div class="card">
            <div class="title">ğŸ“¦ Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î± Î Î±ÏÎ±Î»Î±Î²Î®Ï‚</div>
            <div class="input-group"><input type="text" id="pickupName" placeholder="ÎŸÎ½Î¿Î¼Î±Ï„ÎµÏ€ÏÎ½Ï…Î¼Î¿ (Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î­Î±Ï‚)"></div>
            <div class="row">
                <div class="input-group"><input type="tel" id="pickupPhone" placeholder="Î¤Î·Î»Î­Ï†Ï‰Î½Î¿"></div>
                <div class="input-group"><input type="text" id="pickupTime" placeholder="ÎÏÎ± (Ï€.Ï‡. 14:30)" onfocus="(this.type='time')"></div>
            </div>
        </div>

        <div class="card">
            <div class="title">ğŸ  Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Î± Î Î±ÏÎ¬Î´Î¿ÏƒÎ·Ï‚</div>
            <div class="input-group"><input type="text" id="deliveryName" placeholder="ÎŸÎ½Î¿Î¼Î±Ï„ÎµÏ€ÏÎ½Ï…Î¼Î¿ (Î Î±ÏÎ±Î»Î®Ï€Ï„Î·Ï‚)"></div>
            <div class="input-group"><input type="tel" id="deliveryPhone" placeholder="Î¤Î·Î»Î­Ï†Ï‰Î½Î¿ Î Î±ÏÎ±Î»Î®Ï€Ï„Î·"></div>
            <div class="row" style="margin-bottom: 15px;">
                <div class="input-group"><input type="text" id="deliveryDate" placeholder="Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±" onfocus="(this.type='date')"></div>
                <div class="input-group"><input type="text" id="deliveryTime" placeholder="ÎÏÎ± (Ï€.Ï‡. 15:00)" onfocus="(this.type='time')"></div>
            </div>
            <div class="input-group">
                <textarea id="deliveryNote" rows="3" placeholder="Î£Ï‡ÏŒÎ»Î¹Î±: ÎŒÏÎ¿Ï†Î¿Ï‚, ÎšÎ¿Ï…Î´Î¿ÏÎ½Î¹, ÎºÎ»Ï€ (Î¥Ï€Î¿Ï‡ÏÎµÏ‰Ï„Î¹ÎºÏŒ)"></textarea>
            </div>
            <div class="input-group" style="margin-bottom: 0;">
                <select id="paymentMethod">
                    <option value="ÎœÎµÏ„ÏÎ·Ï„Î¬">ğŸ’µ Î Î»Î·ÏÏ‰Î¼Î®: ÎœÎµÏ„ÏÎ·Ï„Î¬</option>
                    <option value="ÎšÎ¬ÏÏ„Î± (POS)">ğŸ’³ Î Î»Î·ÏÏ‰Î¼Î®: ÎšÎ¬ÏÏ„Î± (POS)</option>
                </select>
            </div>
        </div>
        <button id="sendBtn" onclick="submitOrder()">ÎŸÎ»Î¿ÎºÎ»Î·ÏÏ‰ÏƒÎ· Î Î±ÏÎ±Î³Î³ÎµÎ»Î¹Î±Ï‚</button>
    </div>
    <div style="background: var(--secondary); color: white; padding: 40px 20px; margin-top: 20px; font-size: 14px;">
        <p><strong>2Fast Delivery</strong> - Î— Î»ÏÏƒÎ· ÏƒÏ„Î¹Ï‚ Ï„Î±Ï‡Ï…Î¼ÎµÏ„Î±Ï†Î¿ÏÎ­Ï‚.</p>
        <p>Email: 2fastdelivery1@gmail.com | Î¤Î·Î»: 6934021792</p>
        <p><a href="#" onclick="openModal('termsModal')" style="color: #cbd5e1;">ÎŒÏÎ¿Î¹ Î§ÏÎ®ÏƒÎ·Ï‚</a> | <a href="#" onclick="openModal('privacyModal')" style="color: #cbd5e1;">Î‘Ï€ÏŒÏÏÎ·Ï„Î¿</a></p>
    </div>

    <div class="support-menu" id="supportMenu">
        <a href="https://wa.me/306934021792" class="support-item">ğŸŸ¢ WhatsApp Support</a>
        <a href="#" onclick="logoutUser()" class="support-item" style="color: red;">ğŸ”´ Î‘Ï€Î¿ÏƒÏÎ½Î´ÎµÏƒÎ·</a>
    </div>
    <div class="support-fab" onclick="toggleSupport()">ğŸ§</div>

    <div id="termsModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('termsModal')">&times;</span>
            <h2 style="color: #1E293B;">ÎŒÏÎ¿Î¹ Î§ÏÎ®ÏƒÎ·Ï‚</h2>
            <p>1. Î‘Î½Î±Î»Î±Î¼Î²Î¬Î½Î¿Ï…Î¼Îµ Ï„Î·Î½ Î±Î³Î¿ÏÎ¬ Î±Î³Î±Î¸ÏÎ½ Î³Î¹Î± Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ ÏƒÎ±Ï‚.</p>
            <p>2. Î Î»Î·ÏÏÎ½ÎµÏ„Îµ Ï„Î·Î½ Î±Ï€ÏŒÎ´ÎµÎ¹Î¾Î· Î±Î³Î¿ÏÎ¬Ï‚ ÎºÎ±Î¹ Ï„Î·Î½ Î±Ï€ÏŒÎ´ÎµÎ¹Î¾Î· Î¼ÎµÏ„Î±Ï†Î¿ÏÎ¬Ï‚ Î¾ÎµÏ‡Ï‰ÏÎ¹ÏƒÏ„Î¬.</p>
        </div>
    </div>
    <div id="privacyModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('privacyModal')">&times;</span>
            <h2 style="color: #1E293B;">Î Î¿Î»Î¹Ï„Î¹ÎºÎ® Î‘Ï€Î¿ÏÏÎ®Ï„Î¿Ï…</h2>
            <p>Î£Ï…Î»Î»Î­Î³Î¿Ï…Î¼Îµ ÏŒÎ½Î¿Î¼Î±, Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· ÎºÎ±Î¹ Ï„Î·Î»Î­Ï†Ï‰Î½Î¿ Î¼ÏŒÎ½Î¿ Î³Î¹Î± Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ· Ï„Î·Ï‚ Ï€Î±ÏÎ¬Î´Î¿ÏƒÎ·Ï‚. (GDPR)</p>
        </div>
    </div>
    <script>
        function toggleSupport() { document.getElementById('supportMenu').classList.toggle('active'); }
        function openModal(id) { document.getElementById(id).style.display = "block"; }
        function closeModal(id) { document.getElementById(id).style.display = "none"; }
        
        let map, dirService, dirRenderer, startAuto, endAuto, calculatedPrice = 0;
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyWoTtkdD_krJ20SutUK0Yp9WlRIuUwFGE3D88lSuG97j_6WP1DqvYbYcMvsL8ZYrLMcg/exec";

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), { zoom: 13, center: { lat: 37.9429, lng: 23.6470 }, disableDefaultUI: true });
            dirService = new google.maps.DirectionsService();
            dirRenderer = new google.maps.DirectionsRenderer({ map: map });
            const opts = { componentRestrictions: { country: "gr" } };
            startAuto = new google.maps.places.Autocomplete(document.getElementById('start'), opts);
            endAuto = new google.maps.places.Autocomplete(document.getElementById('end'), opts);
            startAuto.addListener("place_changed", calc);
            endAuto.addListener("place_changed", calc);
        }

        function calc() {
            const start = document.getElementById('start').value;
            const end = document.getElementById('end').value;
            if (start.length > 3 && end.length > 3) {
                dirService.route({ origin: start, destination: end, travelMode: 'DRIVING' }, (res, status) => {
                    if (status === 'OK') {
                        dirRenderer.setDirections(res);
                        const km = res.routes[0].legs[0].distance.value / 1000;
                        if (km > 35) { document.getElementById('priceDisplay').innerText = "ğŸš«"; return; }
                        let price = 3.00;
                        if (km > 0.5) {
                            let rem = km - 0.5;
                            if (rem <= 3.5) price += rem * 0.50;
                            else { price += 3.5 * 0.50; rem -= 3.5; let rate = 0.60; while(rem > 0) { price += (rem>=1?1:rem)*rate; rem--; rate+=0.10; } }
                        }
                        calculatedPrice = price.toFixed(2);
                        document.getElementById('priceDisplay').innerText = calculatedPrice + " â‚¬";
                    }
                });
            }
        }

        function submitOrder() {
            if (calculatedPrice == 0) return alert("Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚!");
            const notes = document.getElementById('deliveryNote').value;
            if (notes.trim() === "") return alert("Î“ÏÎ¬ÏˆÏ„Îµ Î£Ï‡ÏŒÎ»Î¹Î±/ÎŒÏÎ¿Ï†Î¿!");
            
            document.getElementById('sendBtn').innerText = "Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®... â³";
            const payload = {
                startAddr: document.getElementById('start').value,
                endAddr: document.getElementById('end').value,
                price: calculatedPrice,
                pickupName: document.getElementById('pickupName').value,
                pickupPhone: document.getElementById('pickupPhone').value,
                pickupTime: document.getElementById('pickupTime').value,
                deliveryName: document.getElementById('deliveryName').value,
                deliveryPhone: document.getElementById('deliveryPhone').value,
                deliveryDate: document.getElementById('deliveryDate').value,
                deliveryTime: document.getElementById('deliveryTime').value,
                notes: "Î Î›Î—Î¡Î©ÎœÎ—: " + document.getElementById('paymentMethod').value + " | " + notes
            };

            if (window.saveData) window.saveData(payload.deliveryName, payload.deliveryPhone, payload.endAddr, document.getElementById('deliveryNote').value);

            fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(payload) })
            .then(r => r.text()).then(d => { alert("Î•Ï€Î¹Ï„Ï…Ï‡Î¯Î±!"); window.location.reload(); });
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAdeWVPf1-3ZObret2Onsjb6_DldLgaQCw&libraries=places&callback=initMap" async defer></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const app = initializeApp({
            apiKey: "AIzaSyDHmXVo-2kFvCFN3Q8U_MvJl_By_b6hs2w",
            authDomain: "fast-delivery-8227d.firebaseapp.com",
            projectId: "fast-delivery-8227d",
            storageBucket: "fast-delivery-8227d.firebasestorage.app"
        });
        const auth = getAuth(app);
        const db = getFirestore(app);

        onAuthStateChanged(auth, async (user) => {
            if (!user) { window.location.replace("login.html"); } 
            else {
                if (user.displayName) document.getElementById('deliveryName').value = user.displayName;
                const d = await getDoc(doc(db, "users", user.uid));
                if (d.exists()) {
                    const data = d.data();
                    if(data.n) document.getElementById('deliveryName').value = data.n;
                    if(data.p) document.getElementById('deliveryPhone').value = data.p;
                    if(data.a) { document.getElementById('end').value = data.a; setTimeout(calc, 500); }
                    if(data.txt) document.getElementById('deliveryNote').value = data.txt;
                }
            }
        });

        window.saveData = function(n, p, a, txt) {
            if (auth.currentUser) setDoc(doc(db, "users", auth.currentUser.uid), { n:n, p:p, a:a, txt:txt, email: auth.currentUser.email }, { merge: true });
        };
        window.logoutUser = function() { signOut(auth); }
    </script>
</body>
</html>
