<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#1E293B">
    <title>2Fast Delivery | Online Παραγγελία</title>
    
    <style>
        :root { --primary: #FF5722; --secondary: #1E293B; --bg: #F1F5F9; --card: #FFFFFF; --text: #334155; --border: #E2E8F0; }
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); display: flex; flex-direction: column; min-height: 100vh; }
        
        .install-banner { background: var(--primary); color: white; padding: 12px 15px; font-size: 13px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .install-text { flex: 1; line-height: 1.4; }
        .install-close { background: none; border: none; color: white; font-size: 22px; font-weight: bold; cursor: pointer; padding-left: 10px; }
        
        .app-header { background: var(--secondary); padding: 15px; text-align: center; position: relative; z-index: 20; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .app-header img { max-height: 50px; width: auto; object-fit: contain; }
        #map { height: 32vh; min-height: 220px; width: 100%; background: #e0e0e0; }
        .container { padding: 15px; max-width: 600px; margin: 0 auto; padding-bottom: 40px; flex: 1; }
        .card { background: var(--card); padding: 22px; border-radius: 16px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); border: 1px solid rgba(0,0,0,0.02); }
        .title { color: var(--secondary); font-weight: 800; font-size: 14px; text-transform: uppercase; margin-bottom: 18px; letter-spacing: 0.5px; display: flex; align-items: center; gap: 8px; }
        .input-group { margin-bottom: 16px; }
        input, textarea, select { width: 100%; padding: 15px; border: 2px solid var(--border); border-radius: 10px; font-size: 15px; box-sizing: border-box; background: #F8FAFC; transition: all 0.3s ease; font-family: inherit; color: var(--text); }
        input:focus, textarea:focus, select:focus { border-color: var(--primary); background: #fff; outline: none; box-shadow: 0 0 0 3px rgba(255, 87, 34, 0.15); }
        .price-box { background: linear-gradient(135deg, var(--secondary) 0%, #334155 100%); color: white; padding: 25px; border-radius: 16px; text-align: center; margin-bottom: 20px; box-shadow: 0 10px 25px rgba(30, 41, 59, 0.2); }
        .price-val { font-size: 42px; font-weight: 900; margin: 5px 0; color: #fff; }
        .price-dist { font-size: 14px; opacity: 0.8; font-weight: 500; }
        #sendBtn { width: 100%; padding: 20px; background: var(--primary); color: white; border: none; border-radius: 14px; font-size: 18px; font-weight: 800; cursor: pointer; transition: all 0.3s; box-shadow: 0 8px 20px rgba(255, 87, 34, 0.3); text-transform: uppercase; letter-spacing: 1px; }
        #sendBtn:active { transform: scale(0.97); }
        #sendBtn:disabled { background: #cbd5e1; box-shadow: none; cursor: not-allowed; color: #94a3b8; }
        .row { display: flex; gap: 12px; }
        .row .input-group { flex: 1; margin-bottom: 0; }
        .support-fab { position: fixed; bottom: 20px; right: 20px; background: var(--secondary); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 28px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); cursor: pointer; z-index: 1000; transition: 0.3s; }
        .support-fab:hover { transform: scale(1.05); }
        .support-menu { position: fixed; bottom: 90px; right: 20px; display: none; flex-direction: column; gap: 10px; z-index: 1000; }
        .support-menu.active { display: flex; }
        .support-item { background: white; padding: 12px 20px; border-radius: 30px; color: var(--text); text-decoration: none; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border: 1px solid var(--border); display: flex; align-items: center; gap: 10px; }
        .required::after { content: " *"; color: red; }

        .site-footer { background-color: var(--secondary); color: #f8fafc; padding: 50px 20px 20px; margin-top: 40px; font-size: 14px; border-top: 5px solid var(--primary); }
        .footer-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 40px; max-width: 1000px; margin: 0 auto; }
        .footer-section h3 { color: var(--primary); font-size: 16px; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 1px; }
        .footer-section p { line-height: 1.6; color: #cbd5e1; margin-bottom: 10px; }
        .footer-section ul { list-style: none; padding: 0; margin: 0; }
        .footer-section ul li { margin-bottom: 12px; color: #cbd5e1; display: flex; align-items: center; gap: 8px; }
        .footer-section a { color: #cbd5e1; text-decoration: none; transition: 0.3s; cursor: pointer; }
        .footer-section a:hover { color: var(--primary); }
        .footer-bottom { text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); color: #64748b; font-size: 12px; padding-bottom: 60px; }

        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(30, 41, 59, 0.7); backdrop-filter: blur(4px); }
        .modal-content { background-color: var(--card); margin: 5vh auto; padding: 30px; border-radius: 16px; width: 90%; max-width: 650px; max-height: 85vh; overflow-y: auto; position: relative; box-shadow: 0 10px 40px rgba(0,0,0,0.3); animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .close-modal { color: #94a3b8; position: absolute; top: 15px; right: 20px; font-size: 32px; font-weight: bold; cursor: pointer; transition: 0.2s; line-height: 1; }
        .close-modal:hover { color: var(--primary); }
        .modal-title { color: var(--secondary); margin-top: 0; border-bottom: 2px solid var(--border); padding-bottom: 15px; margin-bottom: 20px; font-size: 22px; font-weight: 800; }
        .modal-body { color: var(--text); line-height: 1.7; font-size: 15px; }
        .modal-body h4 { color: var(--secondary); margin-top: 25px; margin-bottom: 10px; font-size: 16px; }
        .faq-q { font-weight: 800; color: var(--primary); margin-top: 20px; }
        .faq-a { margin-bottom: 15px; padding-left: 15px; border-left: 3px solid var(--border); color: #475569; }
    </style>
</head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2MFNJRKE78"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-2MFNJRKE78');
</script>
<body>

    <div class="install-banner" id="installBanner" style="display: none;">
        <div class="install-text">
            <strong>📲 Εγκαταστήστε την εφαρμογή μας!</strong><br>
            Πατήστε τις ρυθμίσεις του browser (⋮) και επιλέξτε <b>"Προσθήκη στην Αρχική Οθόνη"</b>.
        </div>
        <button class="install-close" onclick="closeInstallBanner()">×</button>
    </div>

    <div class="app-header">
        <img src="https://via.placeholder.com/300x80/1E293B/FFFFFF?text=2Fast+Delivery" alt="2Fast Delivery Logo" id="logoImage">
    </div>

    <div id="map"></div>

    <div class="container">
        
        <div class="card" style="margin-top: -30px; position: relative; z-index: 10;">
            <div class="title">📍 Σημεία Διαδρομής</div>
            <div class="input-group">
                <input type="text" id="start" placeholder="Από: Οδός Αριθμός, Περιοχή" onblur="calc()" autocomplete="new-password">
            </div>
            <div class="input-group" style="margin-bottom: 25px;">
                <input type="text" id="end" placeholder="Προς: Οδός Αριθμός, Περιοχή" onblur="calc()" autocomplete="new-password">
            </div>
            <div class="price-box" id="priceBox">
                <div style="font-size: 12px; opacity: 0.8; text-transform: uppercase; font-weight: bold; letter-spacing: 1px;">Κοστος Αποστολης</div>
                <div class="price-val" id="priceDisplay">0.00 €</div>
                <div class="price-dist" id="distDisplay">Επιλέξτε διευθύνσεις στο χάρτη</div>
            </div>
        </div>

        <div class="card">
            <div class="title">📦 Στοιχεία Παραλαβής</div>
            <div class="input-group">
                <input type="text" id="pickupName" placeholder="Ονοματεπώνυμο / Εταιρεία (Αποστολέας)">
            </div>
            <div class="row">
                <div class="input-group">
                    <input type="tel" id="pickupPhone" placeholder="Τηλέφωνο">
                </div>
                <div class="input-group">
                    <input type="text" id="pickupTime" placeholder="Ώρα (π.χ. 14:30)" onfocus="(this.type='time')" onblur="if(!this.value) this.type='text'">
                </div>
            </div>
        </div>

        <div class="card">
            <div class="title">🏠 Στοιχεία Παράδοσης</div>
            <div class="input-group">
                <input type="text" id="deliveryName" placeholder="Ονοματεπώνυμο (Παραλήπτης)">
            </div>
            <div class="input-group">
                <input type="tel" id="deliveryPhone" placeholder="Τηλέφωνο Παραλήπτη">
            </div>
            <div class="row" style="margin-bottom: 16px;">
                <div class="input-group">
                    <input type="text" id="deliveryDate" placeholder="Ημερομηνία" onfocus="(this.type='date')" onblur="if(!this.value) this.type='text'">
                </div>
                <div class="input-group">
                    <input type="text" id="deliveryTime" placeholder="Ώρα (π.χ. 15:00)" onfocus="(this.type='time')" onblur="if(!this.value) this.type='text'">
                </div>
            </div>
            
            <div class="input-group">
                <div class="title required" style="font-size: 11px; margin-bottom: 5px;">ΣΧΟΛΙΑ ΠΑΡΑΔΟΣΗΣ</div>
                <textarea id="deliveryNote" rows="3" placeholder="Υποχρεωτικό πεδίο: Γράψτε Όροφο, Κουδούνι, ή Οδηγίες..."></textarea>
            </div>

            <div class="input-group" style="margin-bottom: 0;">
                <div class="title" style="font-size: 11px; margin-bottom: 5px;">ΤΡΟΠΟΣ ΠΛΗΡΩΜΗΣ</div>
                <select id="paymentMethod">
                    <option value="Μετρητά">💵 Πληρωμή: Μετρητά</option>
                    <option value="Κάρτα (POS)">💳 Πληρωμή: Κάρτα (POS)</option>
                </select>
            </div>
        </div>

        <button id="sendBtn" onclick="submitOrder()">Ολοκληρωση Παραγγελιας</button>

    </div>

    <footer class="site-footer">
        <div class="footer-grid">
            <div class="footer-section">
                <h3>Σχετικα με εμας</h3>
                <p>Η <strong>2Fast Delivery</strong> είναι η σύγχρονη λύση στις ταχυμεταφορές. Πέρα από απλά δέματα, αναλαμβάνουμε να σας φέρουμε ό,τι χρειάζεστε: από <strong>φάρμακα</strong> και <strong>είδη περιπτέρου (όπως τσιγάρα)</strong>, μέχρι οτιδήποτε άλλο θελήσετε, άμεσα και με ασφάλεια στην πόρτα σας!</p>
            </div>
            
            <div class="footer-section">
                <h3>Τι Προσφερουμε</h3>
                <ul>
                    <li>🚀 Άμεση παραλαβή και παράδοση</li>
                    <li>💊 Θελήματα Φαρμακείου & Περιπτέρου</li>
                    <li>🛍️ Εξυπηρέτηση επιχειρήσεων & ιδιωτών</li>
                    <li>🎧 Ζωντανή υποστήριξη πελατών</li>
                </ul>
            </div>

            <div class="footer-section">
                <h3>Επικοινωνια</h3>
                <p><strong>Τηλέφωνο:</strong> <a href="tel:+306934021792">6934 021 792</a></p>
                <p><strong>Email:</strong> <a href="mailto:2fastdelivery1@gmail.com">2fastdelivery1@gmail.com</a></p>
                <p><strong>Ωράριο Λειτουργίας:</strong><br>Δευτέρα - Σάββατο<br>09:00 - 21:00</p>
            </div>

            <div class="footer-section">
                <h3>Χρησιμοι Συνδεσμοι</h3>
                <ul>
                    <li><a onclick="openModal('termsModal')">Όροι Χρήσης & Προϋποθέσεις</a></li>
                    <li><a onclick="openModal('privacyModal')">Πολιτική Απορρήτου</a></li>
                    <li><a onclick="openModal('faqModal')">Συχνές Ερωτήσεις (FAQ)</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            &copy; 2026 2Fast Delivery. Με επιφύλαξη παντός δικαιώματος.
        </div>
    </footer>

        <div class="support-menu" id="supportMenu">
        <a href="profile.html" class="support-item" style="color: var(--primary);">👤 Το Προφίλ μου</a>
        <a href="https://wa.me/306934021792" class="support-item" target="_blank">🟢 WhatsApp Support</a>
        <a href="#" onclick="logoutUser()" class="support-item" style="color: red;">🔴 Αποσύνδεση</a>
    </div>
    <div class="support-fab" onclick="toggleSupport()">🎧</div>

    <div id="termsModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('termsModal')">&times;</span>
            <h2 class="modal-title">Όροι Χρήσης Πλατφόρμας (Β2C Θελήματα)</h2>
            <div class="modal-body">
                <h4>1. Εισαγωγή</h4>
                <p>Καλώς ήρθατε στην πλατφόρμα <strong>2FastDelivery.gr</strong>, η οποία ανήκει στην εταιρεία <strong>ΔΙΑΝΟΜΕΙΣ Ο.Ε.</strong> Η χρήση της Πλατφόρμας μας συνεπάγεται την πλήρη και ανεπιφύλακτη αποδοχή των παρόντων Όρων Χρήσης. Εάν δεν συμφωνείτε, παρακαλούμε να μην κάνετε χρήση των υπηρεσιών μας.</p>

                <h4>2. Περιγραφή Υπηρεσιών</h4>
                <p>Η Πλατφόρμα παρέχει υπηρεσίες εξυπηρέτησης φυσικών προσώπων («θελήματα»), αναλαμβάνοντας την παραλαβή παραγγελιών, την αγορά αγαθών για λογαριασμό του πελάτη (π.χ. από φαρμακεία, παντοπωλεία) και την κατ' οίκον παράδοσή τους. Η εταιρεία μας δεν εμπορεύεται τα προϊόντα, αλλά λειτουργεί αποκλειστικά ως εντολοδόχος μεταφοράς.</p>

                <h4>3. Αγορές για Λογαριασμό Πελάτη & Διαδικασία Πληρωμής</h4>
                <p><strong>Προκαταβολή Κόστους:</strong> Ο διανομέας της Πλατφόρμας καταβάλλει στο κατάστημα (π.χ. φαρμακείο) το αντίτιμο των προϊόντων για λογαριασμό του πελάτη.<br>
                <strong>Απόδειξη Αγοράς:</strong> Η νόμιμη απόδειξη αγοράς των προϊόντων εκδίδεται από το εκάστοτε κατάστημα απευθείας προς τον πελάτη και του παραδίδεται μαζί με τα προϊόντα.<br>
                <strong>Αποπληρωμή & Αμοιβή:</strong> Κατά την παράδοση, ο πελάτης υποχρεούται να καταβάλει στον διανομέα:<br>
                α) Το ακριβές αντίτιμο της απόδειξης αγοράς των προϊόντων.<br>
                β) Το κόστος της υπηρεσίας μεταφοράς/θελήματος, για το οποίο εκδίδεται ξεχωριστή Απόδειξη Παροχής Υπηρεσιών (ΑΠΥ) από την εταιρεία μας.</p>

                <h4>4. Περιορισμός Ευθύνης</h4>
                <p>Η Πλατφόρμα ευθύνεται αποκλειστικά και μόνο για την ασφαλή και έγκαιρη μεταφορά των αγαθών.<br>
                <strong>Ποιότητα Προϊόντων:</strong> Δεν φέρουμε καμία ευθύνη για την ποιότητα, την κατάσταση, τις ημερομηνίες λήξης ή τα ελαττώματα των προϊόντων που αγοράζονται από τρίτα καταστήματα.<br>
                <strong>Φάρμακα & Ιατρικές Συμβουλές:</strong> Η Πλατφόρμα δεν παρέχει ιατρικές ή φαρμακευτικές συμβουλές. Σε περίπτωση παράδοσης φαρμάκων, η ευθύνη για τη σωστή επιλογή του φαρμάκου (βάσει της παραγγελίας του πελάτη ή της συνταγής) βαρύνει αποκλειστικά τον πελάτη και τον αδειούχο φαρμακοποιό.<br>
                <strong>Λάθη Καταστημάτων:</strong> Αν το κατάστημα παραδώσει λάθος προϊόν, η εταιρεία μας δεν υποχρεούται σε δωρεάν αντικατάσταση, εκτός εάν το λάθος οφείλεται σε δική μας υπαιτιότητα κατά τη διαβίβαση της παραγγελίας.</p>

                <h4>5. Απαγορευμένα Είδη</h4>
                <p>Δεν αναλαμβάνουμε τη μεταφορά παράνομων ουσιών, εκρηκτικών υλών, εύφλεκτων υλικών, αντικειμένων πολύ μεγάλης αξίας και αντικειμένων που η μεταφορά τους απαγορεύεται από την ελληνική νομοθεσία. Η εταιρεία διατηρεί το δικαίωμα να αρνηθεί την εκτέλεση οποιασδήποτε παραγγελίας κρίνει ύποπτη ή επικίνδυνη.</p>

                <h4>6. Προσωπικά Δεδομένα</h4>
                <p>Για την εκτέλεση της υπηρεσίας, συλλέγουμε απολύτως απαραίτητα δεδομένα (όνομα, διεύθυνση, τηλέφωνο). Ειδικά για παραγγελίες φαρμακείου, τα δεδομένα αυτά αντιμετωπίζονται με απόλυτη εχεμύθεια. Για περισσότερες λεπτομέρειες, δείτε την Πολιτική Απορρήτου μας.</p>

                <h4>7. Πολιτική Ακυρώσεων</h4>
                <p>Ο πελάτης μπορεί να ακυρώσει την παραγγελία του χωρίς χρέωση πριν ο διανομέας προβεί στην αγορά του προϊόντος. Αν το προϊόν έχει ήδη αγοραστεί, ο πελάτης υποχρεούται να καταβάλει το πλήρες ποσό της απόδειξης καθώς και το κόστος μεταφοράς.</p>
            </div>
        </div>
    </div>

    <div id="privacyModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('privacyModal')">&times;</span>
            <h2 class="modal-title">Πολιτική Απορρήτου</h2>
            <div class="modal-body">
                <p>Η <strong>2Fast Delivery</strong> σέβεται τα προσωπικά σας δεδομένα (GDPR).</p>
                <h4>1. Δεδομένα που συλλέγουμε</h4>
                <p>Ονοματεπώνυμο, τηλέφωνο, διεύθυνση και οδηγίες παράδοσης.</p>
                <h4>2. Χρήση των Δεδομένων</h4>
                <p>Χρησιμοποιούνται αποκλειστικά για την επιτυχή εκτέλεση της μεταφοράς και την επικοινωνία του διανομέα μαζί σας.</p>
                <h4>3. Κοινοποίηση</h4>
                <p>Τα δεδομένα μεταφέρονται κρυπτογραφημένα στο σύστημα διαχείρισης στόλου που χρησιμοποιούμε (Shipday). Δεν πωλούνται σε τρίτους.</p>
            </div>
        </div>
    </div>

    <div id="faqModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('faqModal')">&times;</span>
            <h2 class="modal-title">Συχνές Ερωτήσεις (FAQ)</h2>
            <div class="modal-body">
                <div class="faq-q">1. Μπορείτε να μου φέρετε φάρμακα ή τσιγάρα;</div>
                <div class="faq-a">Φυσικά! Αναλαμβάνουμε αγορές από το φαρμακείο ή το περίπτερο της περιοχής σας. Εσείς πληρώνετε απλά τα μεταφορικά και το κόστος των προϊόντων.</div>
                
                <div class="faq-q">2. Πώς μπορώ να πληρώσω;</div>
                <div class="faq-a">Μπορείτε να πληρώσετε τον διανομέα μας κατά την παράδοση με Μετρητά ή Κάρτα (POS).</div>
                
                <div class="faq-q">3. Ποιες περιοχές εξυπηρετείτε;</div>
                <div class="faq-a">Το σύστημά μας υπολογίζει αυτόματα την απόσταση. Αν είστε εντός εμβέλειας, θα βγάλει κανονικά την τιμή.</div>
            </div>
        </div>
    </div>
    <script>
        function openModal(id) {
            document.getElementById(id).style.display = "block";
            document.body.style.overflow = "hidden";
        }

        function closeModal(id) {
            document.getElementById(id).style.display = "none";
            document.body.style.overflow = "auto";
        }

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = "none";
                document.body.style.overflow = "auto";
            }
        }

        if (!localStorage.getItem('hideAppBanner')) {
            document.getElementById('installBanner').style.display = 'flex';
        }
        function closeInstallBanner() {
            localStorage.setItem('hideAppBanner', 'true');
            document.getElementById('installBanner').style.display = 'none';
        }

        function toggleSupport() { document.getElementById('supportMenu').classList.toggle('active'); }
        const MAX_KM = 35;
        let map, dirService, dirRenderer, startAuto, endAuto;
        let calculatedPrice = 0;

        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyWoTtkdD_krJ20SutUK0Yp9WlRIuUwFGE3D88lSuG97j_6WP1DqvYbYcMvsL8ZYrLMcg/exec";

        function initMap() {
            try {
                map = new google.maps.Map(document.getElementById('map'), { zoom: 13, center: { lat: 37.9429, lng: 23.6470 }, disableDefaultUI: true });
                dirService = new google.maps.DirectionsService();
                dirRenderer = new google.maps.DirectionsRenderer({ map: map, polylineOptions: { strokeColor: "#1E293B", strokeWeight: 6 } });
                initAuto();
            } catch (e) { console.error("Map:", e); }
        }

        function initAuto() {
            const opts = { componentRestrictions: { country: "gr" }, fields: ["geometry", "name"] };
            startAuto = new google.maps.places.Autocomplete(document.getElementById('start'), opts);
            endAuto = new google.maps.places.Autocomplete(document.getElementById('end'), opts);
            startAuto.addListener("place_changed", calc);
            endAuto.addListener("place_changed", calc);
        }

        function calc() {
            const start = document.getElementById('start').value;
            const end = document.getElementById('end').value;
            if (start.length > 3 && end.length > 3) {
                dirService.route({ origin: start, destination: end, travelMode: 'DRIVING' }, (res, status) => {
                    if (status === 'OK') {
                        dirRenderer.setDirections(res);
                        const km = res.routes[0].legs[0].distance.value / 1000;
                        const txt = res.routes[0].legs[0].distance.text;
                        if (km > MAX_KM) { document.getElementById('priceDisplay').innerText = "🚫"; calculatedPrice = 0; return; }
                        
                        let price = 3.00;
                        if (km > 0.5) {
                            let rem = km - 0.5;
                            if (rem <= 3.5) price += rem * 0.50;
                            else { price += 3.5 * 0.50; rem -= 3.5; let rate = 0.60; while(rem > 0) { price += (rem>=1?1:rem)*rate; rem--; rate+=0.10; } }
                        }
                        calculatedPrice = price.toFixed(2);
                        document.getElementById('priceDisplay').innerText = calculatedPrice + " €";
                        document.getElementById('distDisplay').innerText = txt + " απόσταση • ~" + res.routes[0].legs[0].duration.text;
                        
                        if (typeof gtag === 'function') {
                            gtag('event', 'delivery_quote', {
                                'currency': 'EUR',
                                'value': parseFloat(calculatedPrice)
                            });
                        }
                    }
                });
            }
        }

        function submitOrder() {
            if (calculatedPrice == 0) { alert("📍 Παρακαλώ επιλέξτε διευθύνσεις παραλαβής και παράδοσης!"); return; }

            const rawNotes = document.getElementById('deliveryNote').value.trim();
            if (rawNotes === "") {
                alert("⚠️ Παρακαλώ συμπληρώστε τα Σχόλια Παράδοσης (Όροφος, Κουδούνι) για να διευκολύνετε τον οδηγό!");
                document.getElementById('deliveryNote').style.borderColor = "red";
                document.getElementById('deliveryNote').focus();
                return; 
            } else {
                document.getElementById('deliveryNote').style.borderColor = "#E2E8F0"; 
            }

            const btn = document.getElementById('sendBtn');
            btn.innerText = "Αποστολή... ⏳";
            btn.disabled = true;

            const payment = document.getElementById('paymentMethod').value;
            const combinedNotes = "ΠΛΗΡΩΜΗ: " + payment + " | ΣΧΟΛΙΑ: " + rawNotes;

            const payload = {
                startAddr: document.getElementById('start').value,
                endAddr: document.getElementById('end').value,
                price: calculatedPrice,
                pickupName: document.getElementById('pickupName').value,
                pickupPhone: document.getElementById('pickupPhone').value,
                pickupTime: document.getElementById('pickupTime').value,
                deliveryName: document.getElementById('deliveryName').value,
                deliveryPhone: document.getElementById('deliveryPhone').value,
                deliveryDate: document.getElementById('deliveryDate').value,
                deliveryTime: document.getElementById('deliveryTime').value,
                notes: combinedNotes
            };

            // --- Αποθήκευση στη Βάση (Firestore) ---
            if (window.saveDeliveryData) {
                window.saveDeliveryData(
                    payload.deliveryName, 
                    payload.deliveryPhone,
                    document.getElementById('end').value,
                    document.getElementById('deliveryNote').value
                );
            }

            fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(payload) })
            .then(response => response.text())
            .then(data => {
                if(data.includes("Success")) {
                    alert("✅ Η παραγγελία σας καταχωρήθηκε επιτυχώς!");
                    window.location.reload();
                } else {
                    alert("⚠️ Σφάλμα Συστήματος.");
                    btn.innerText = "Ολοκληρωση Παραγγελιας"; btn.disabled = false;
                }
            })
            .catch(error => { alert("❌ Σφάλμα σύνδεσης."); btn.innerText = "Ολοκληρωση Παραγγελιας"; btn.disabled = false; });
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAdeWVPf1-3ZObret2Onsjb6_DldLgaQCw&libraries=places&callback=initMap" async defer></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDHmXVo-2kFvCFN3Q8U_MvJl_By_b6hs2w",
            authDomain: "fast-delivery-8227d.firebaseapp.com",
            projectId: "fast-delivery-8227d",
            storageBucket: "fast-delivery-8227d.firebasestorage.app",
            messagingSenderId: "751019896171",
            appId: "1:751019896171:web:44530a82b4f016fb1ef02e"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // 1. Έλεγχος Σύνδεσης & Αυτόματη Συμπλήρωση
        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                window.location.replace("login.html");
            } else {
                if (user.displayName && !document.getElementById('deliveryName').value) {
                    document.getElementById('deliveryName').value = user.displayName;
                }

                // Τραβάμε τα αποθηκευμένα στοιχεία από τη Βάση
                const docRef = doc(db, "users", user.uid);
                const docSnap = await getDoc(docRef);
                
                if (docSnap.exists()) {
                    const data = docSnap.data();
                   
              // --- ΝΕΟΣ ΕΛΕΓΧΟΣ ΜΠΛΟΚΑΡΙΣΜΑΤΟΣ ---
                    if (data.isBlocked) {
                        alert("⛔ Ο λογαριασμός σας έχει ανασταλεί. Παρακαλώ επικοινωνήστε με την υποστήριξη.");
                        signOut(auth).then(() => { window.location.replace("login.html"); });
                        return;
                    }
                    // ------------------------------------

                    if (data.name) document.getElementById('deliveryName').value = data.name;
                    if (data.phone) document.getElementById('deliveryPhone').value = data.phone;
                    if (data.address) document.getElementById('end').value = data.address;
                    if (data.notes) document.getElementById('deliveryNote').value = data.notes;
                    
                    if (data.address && typeof calc === 'function') {
                        setTimeout(calc, 500);
                    }
                }
            }
        });

        // 2. Αποθήκευση ΟΛΩΝ των στοιχείων στη Βάση
        window.saveDeliveryData = function(name, phone, address, notes) {
            const user = auth.currentUser;
            if (user) {
                setDoc(doc(db, "users", user.uid), {
                    name: name,
                    phone: phone,
                    address: address,
                    notes: notes,
                    email: user.email
                }, { merge: true }).catch(err => console.log("Firestore Error:", err));
            }
        };

        // 3. Αποσύνδεση
        window.logoutUser = function() {
            signOut(auth).then(() => {
                window.location.replace("login.html");
            });
        }
    </script>
</body>
</html>
