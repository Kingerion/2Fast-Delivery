<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#2196f3">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/7541/7541900.png">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/7541/7541900.png">

    <title>2Fast Delivery App</title>
    
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: #f8f9fa; -webkit-tap-highlight-color: transparent; }
        
        /* FIX: Min-height Î³Î¹Î± Î½Î± Î¼Î·Î½ ÎµÎ¾Î±Ï†Î±Î½Î¯Î¶ÎµÏ„Î±Î¹ Ï€Î¿Ï„Î­ */
        #map { height: 38vh; min-height: 250px; width: 100%; border-bottom-left-radius: 20px; border-bottom-right-radius: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); background: #e0e0e0; }

        .container { 
            padding: 20px; 
            max-width: 600px;
            margin: 0 auto;
            position: relative; 
            top: -15px; 
            z-index: 999;
            padding-bottom: 80px; 
        }

        h2 { margin-top: 10px; color: #333; text-align: center; font-size: 22px; font-weight: 800; margin-bottom: 20px; letter-spacing: -0.5px; }
        
        /* Cards */
        .section-card {
            background: #fff;
            border: none;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.03);
            transition: transform 0.2s;
        }

        .section-title {
            font-size: 13px;
            font-weight: 800;
            color: #2196f3;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            display: flex;
            align-items: center;
        }
        .section-title span { margin-right: 8px; font-size: 18px; }

        .input-group { margin-bottom: 12px; }
        label { font-size: 12px; font-weight: 600; color: #666; margin-bottom: 6px; display: block; }
        
        input, textarea, select { 
            width: 100%; 
            padding: 14px; 
            border: 1px solid #eee; 
            border-radius: 12px; 
            box-sizing: border-box; 
            font-size: 16px; 
            background: #fdfdfd; 
            transition: all 0.2s;
            appearance: none;
            color: #333;
        }
        input:focus, select:focus { border-color: #2196f3; background: #fff; outline: none; box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1); }

        .row { display: flex; gap: 10px; }
        .col-6 { flex: 1; }
        .col-8 { flex: 0.8; }
        .col-4 { flex: 0.4; }

        /* Time Buttons */
        .time-btn {
            flex: 1;
            padding: 14px;
            border: 1px solid #eee;
            background: #fff;
            border-radius: 12px;
            font-weight: 600;
            color: #555;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 15px;
        }
        .time-btn.active {
            background: #e3f2fd;
            border-color: #2196f3;
            color: #1565c0;
            box-shadow: 0 2px 5px rgba(33, 150, 243, 0.2);
        }

        textarea { resize: vertical; height: 70px; }
        
        .price-box { 
            background: linear-gradient(135deg, #2196f3, #1976d2);
            color: white;
            padding: 20px; 
            border-radius: 16px; 
            text-align: center; 
            margin: 25px 0; 
            box-shadow: 0 8px 20px rgba(33, 150, 243, 0.3);
        }
        .price-label { font-size: 14px; opacity: 0.9; margin-bottom: 5px; }
        .price-value { font-size: 32px; font-weight: 800; }
        .distance-info { font-size: 14px; opacity: 0.9; margin-top: 5px; font-weight: 500; }

        button#sendBtn { 
            width: 100%; 
            padding: 18px; 
            background: #ff5722; 
            color: white; 
            border: none; 
            border-radius: 16px; 
            font-size: 18px; 
            font-weight: 800; 
            cursor: pointer; 
            transition: transform 0.2s; 
            box-shadow: 0 8px 20px rgba(255, 87, 34, 0.3); 
        }
        button:disabled { background: #ccc; cursor: not-allowed; box-shadow: none; }
        button:active { transform: scale(0.96); }
        
        .loader { display: none; border: 3px solid rgba(255,255,255,0.3); border-top: 3px solid #fff; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .pac-container { z-index: 10000 !important; border-radius: 12px; margin-top: 5px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: none; }

        /* MODAL */
        .modal-overlay {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 24px;
            text-align: center;
            width: 85%;
            max-width: 350px;
        }
        .checkmark-circle {
            width: 60px; height: 60px; background: #4CAF50; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; margin: 0 auto 15px;
        }
        .checkmark { color: white; font-size: 30px; }
        .modal-title { font-size: 20px; font-weight: bold; color: #333; margin-bottom: 10px; }
        .modal-text { color: #666; font-size: 15px; margin-bottom: 25px; line-height: 1.5; }
        .modal-btn {
            background: #2196f3; color: white; border: none; padding: 12px 25px;
            border-radius: 12px; font-weight: bold; font-size: 16px; cursor: pointer; width: 100%;
        }
    </style>
</head>
<body>

    <div id="map"></div>

    <div class="container">
        <h2>Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î® Î”Î­Î¼Î±Ï„Î¿Ï‚</h2>
        
        <div class="input-group">
            <label>Î¤Î¿ Î¤Î·Î»Î­Ï†Ï‰Î½ÏŒ ÏƒÎ±Ï‚</label>
            <input type="tel" id="phone" placeholder="69..." required style="font-weight: bold; font-size: 18px; letter-spacing: 1px;">
        </div>

        <div class="section-card">
            <div class="section-title"><span>ğŸ•’</span> Î§Î¡ÎŸÎÎŸÎ£ Î Î‘Î¡Î‘Î›Î‘Î’Î—Î£</div>
            <div class="row">
                <button type="button" class="time-btn active" id="btnNow" onclick="setTimeMode('now')">âš¡ Î¤ÏÏÎ±</button>
                <button type="button" class="time-btn" id="btnLater" onclick="setTimeMode('later')">ğŸ“… Î¡Î±Î½Ï„ÎµÎ²Î¿Ï</button>
            </div>
            <div id="nowMsg" style="margin-top: 12px; font-size: 13px; color: #2e7d32; font-weight: 600; background: #e8f5e9; padding: 8px; border-radius: 8px; text-align: center;">
                ğŸš€ Î†Ï†Î¹Î¾Î· Î´Î¹Î±Î½Î¿Î¼Î­Î± ÏƒÎµ <b>25-35'</b>
            </div>
            <div id="laterInputs" style="display: none; margin-top: 12px;">
                <input type="datetime-local" id="scheduledTime">
            </div>
        </div>

        <div class="section-card">
            <div class="section-title"><span>ğŸ“</span> Î Î‘Î¡Î‘Î›Î‘Î’Î—</div>
            <div class="input-group">
                <input type="text" id="start" placeholder="ğŸ” ÎŸÎ´ÏŒÏ‚ Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚, Î ÎµÏÎ¹Î¿Ï‡Î®..." onblur="calcRoute()">
            </div>
            <div class="row">
                <div class="col-8"><input type="text" id="startName" placeholder="ÎŒÎ½Î¿Î¼Î± / ÎšÎ¿Ï…Î´Î¿ÏÎ½Î¹"></div>
                <div class="col-4"><input type="text" id="startFloor" placeholder="ÎŒÏÎ¿Ï†Î¿Ï‚"></div>
            </div>
        </div>

        <div class="section-card">
            <div class="section-title"><span>ğŸ</span> Î Î‘Î¡Î‘Î”ÎŸÎ£Î—</div>
            <div class="input-group">
                <input type="text" id="end" placeholder="ğŸ” ÎŸÎ´ÏŒÏ‚ Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚, Î ÎµÏÎ¹Î¿Ï‡Î®..." onblur="calcRoute()">
            </div>
            <div class="row input-group">
                <div class="col-8"><input type="text" id="endName" placeholder="ÎŒÎ½Î¿Î¼Î± / ÎšÎ¿Ï…Î´Î¿ÏÎ½Î¹"></div>
                <div class="col-4"><input type="text" id="endFloor" placeholder="ÎŒÏÎ¿Ï†Î¿Ï‚"></div>
            </div>
            <div class="input-group">
                <label>Î¤Î·Î»Î­Ï†Ï‰Î½Î¿ Î Î±ÏÎ±Î»Î®Ï€Ï„Î·</label>
                <input type="tel" id="endPhone" placeholder="Î Î¿Î¹Î¿Î½ ÎºÎ±Î»Î¿ÏÎ¼Îµ;" style="border-left: 3px solid #ff9800;">
            </div>
        </div>

        <div class="section-card">
            <div class="section-title"><span>ğŸ“¦</span> Î›Î•Î Î¤ÎŸÎœÎ•Î¡Î•Î™Î•Î£</div>
            <div class="row input-group">
                <div class="col-6">
                    <label>Î”Î­Î¼Î±</label>
                    <select id="parcelType">
                        <option value="Î¦Î¬ÎºÎµÎ»Î¿Ï‚">ğŸ“„ Î¦Î¬ÎºÎµÎ»Î¿Ï‚</option>
                        <option value="ÎœÎ¹ÎºÏÏŒ Î”Î­Î¼Î±">ğŸ“¦ ÎœÎ¹ÎºÏÏŒ</option>
                        <option value="ÎœÎµÎ³Î¬Î»Î¿ Î”Î­Î¼Î±">ğŸ’ ÎœÎµÎ³Î¬Î»Î¿</option>
                    </select>
                </div>
                <div class="col-6">
                    <label>Î Î»Î·ÏÏ‰Î¼Î®</label>
                    <select id="paymentMethod">
                        <option value="ÎœÎµÏ„ÏÎ·Ï„Î¬">ğŸ’µ ÎœÎµÏ„ÏÎ·Ï„Î¬</option>
                        <option value="ÎšÎ¬ÏÏ„Î± (POS)">ğŸ’³ POS</option>
                        <option value="Iris/Transfer">ğŸ¦ Iris</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="input-group">
            <label>Î£Ï‡ÏŒÎ»Î¹Î± / ÎŸÎ´Î·Î³Î¯ÎµÏ‚</label>
            <textarea id="comments" placeholder="Î“ÏÎ¬ÏˆÏ„Îµ ÎµÎ´Ï Î¿Ï„Î¹Î´Î®Ï€Î¿Ï„Îµ Î¬Î»Î»Î¿..."></textarea>
        </div>

        <div class="price-box">
            <div class="price-label">Î•ÎºÏ„Î¹Î¼ÏÎ¼ÎµÎ½Î¿ ÎšÏŒÏƒÏ„Î¿Ï‚</div>
            <div class="price-value" id="priceDisplay">0.00 â‚¬</div>
            <div class="distance-info" id="distDisplay">-</div>
        </div>

        <button id="sendBtn" onclick="sendOrder()" disabled>
            <span id="btnText">Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î® Î Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±Ï‚</span>
            <div class="loader" id="loader"></div>
        </button>
    </div>

    <div id="successModal" class="modal-overlay">
        <div class="modal-content">
            <div class="checkmark-circle"><span class="checkmark">âœ“</span></div>
            <div class="modal-title">ÎˆÏ„Î¿Î¹Î¼Î¿!</div>
            <div class="modal-text">Î— Ï€Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î± ÏƒÎ±Ï‚ ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ®Î¸Î·ÎºÎµ.<br>ÎˆÎ½Î±Ï‚ Î´Î¹Î±Î½Î¿Î¼Î­Î±Ï‚ Î­ÏÏ‡ÎµÏ„Î±Î¹! ğŸš€</div>
            <button class="modal-btn" onclick="closeModal()">Î•Î½Ï„Î¬Î¾ÎµÎ¹</button>
        </div>
    </div>

    <script>
        var map;
        var directionsService;
        var directionsRenderer;
        var startAutocomplete, endAutocomplete;
        var calculatedPrice = 0;
        var distanceText = "";
        var timeMode = 'now'; 
        
        // --- Î¡Î¥Î˜ÎœÎ™Î£Î•Î™Î£ ---
        const MY_PHONE = "306934021792"; 
        // Î’Î‘Î›Î• Î¤ÎŸ Î”Î™ÎšÎŸ Î£ÎŸÎ¥ LINK:
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz_XXXXXXXXXXXX/exec"; 
        // -----------------

        // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ ÏƒÏ†Î±Î»Î¼Î¬Ï„Ï‰Î½ API
        window.gm_authFailure = function() {
            alert("âš ï¸ Î ÏÏŒÎ²Î»Î·Î¼Î± Î§Î¬ÏÏ„Î· Google!\nÎ•Î»Î­Î³Î¾Ï„Îµ Î±Î½ Î­Ï‡ÎµÏ„Îµ ÎµÎ½ÎµÏÎ³ÏŒ Billing Account ÏƒÏ„Î¿ Google Cloud Î® Î±Î½ Ï„Î¿ ÎºÎ»ÎµÎ¹Î´Î¯ Î­Ï‡ÎµÎ¹ Î»Î®Î¾ÎµÎ¹.");
        };

        function initMap() {
            var defaultCenter = { lat: 37.9429, lng: 23.6470 };
            
            try {
                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 13, center: defaultCenter,
                    mapTypeControl: false, streetViewControl: false, fullscreenControl: false
                });

                directionsService = new google.maps.DirectionsService();
                directionsRenderer = new google.maps.DirectionsRenderer({
                    polylineOptions: { strokeColor: "#2196f3", strokeWeight: 5 }
                });
                directionsRenderer.setMap(map);

                initAutocomplete();
                
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const pos = { lat: position.coords.latitude, lng: position.coords.longitude };
                            map.setCenter(pos);
                            // Î ÏÎ¿ÏƒÏ€Î¬Î¸ÎµÎ¹Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚ autocomplete, Î±Î»Î»Î¬ Î¼Îµ Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î±
                            if(startAutocomplete) startAutocomplete.bindTo("bounds", map);
                            if(endAutocomplete) endAutocomplete.bindTo("bounds", map);
                        }
                    );
                }
            } catch (e) {
                console.error("Map Load Error:", e);
            }
        }

        function initAutocomplete() {
            var options = {
                componentRestrictions: { country: "gr" },
                fields: ["formatted_address", "geometry", "name"],
                strictBounds: false,
                locationBias: { radius: 30000, center: { lat: 37.9429, lng: 23.6470 } }
            };

            var startEl = document.getElementById('start');
            var endEl = document.getElementById('end');

            if(startEl && endEl && google.maps.places) {
                startAutocomplete = new google.maps.places.Autocomplete(startEl, options);
                endAutocomplete = new google.maps.places.Autocomplete(endEl, options);

                startAutocomplete.addListener("place_changed", calcRoute);
                endAutocomplete.addListener("place_changed", calcRoute);
            }
        }

        function setTimeMode(mode) {
            if(navigator.vibrate) navigator.vibrate(50);
            timeMode = mode;
            if (mode === 'now') {
                document.getElementById('btnNow').classList.add('active');
                document.getElementById('btnLater').classList.remove('active');
                document.getElementById('nowMsg').style.display = 'block';
                document.getElementById('laterInputs').style.display = 'none';
            } else {
                document.getElementById('btnNow').classList.remove('active');
                document.getElementById('btnLater').classList.add('active');
                document.getElementById('nowMsg').style.display = 'none';
                document.getElementById('laterInputs').style.display = 'block';
            }
        }

        function calcRoute() {
            var startVal = document.getElementById('start').value;
            var endVal = document.getElementById('end').value;

            // Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î¼ÏŒÎ½Î¿ Î±Î½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Ï„Î¹Î¼Î­Ï‚ ÎºÎ±Î¹ ÏƒÏ„Î± Î´ÏÎ¿ Ï€ÎµÎ´Î¯Î±
            if (startVal && endVal && startVal.length > 3 && endVal.length > 3) {
                var request = {
                    origin: startVal, destination: endVal,
                    travelMode: 'DRIVING',
                    drivingOptions: { departureTime: new Date(Date.now()), trafficModel: 'bestguess' }
                };

                directionsService.route(request, function(result, status) {
                    if (status == 'OK') {
                        directionsRenderer.setDirections(result);
                        var route = result.routes[0].legs[0];
                        var distMeters = route.distance.value;
                        var distKm = distMeters / 1000;
                        distanceText = route.distance.text;

                        calculatedPrice = calculateComplexPrice(distKm);

                        document.getElementById('priceDisplay').innerText = calculatedPrice.toFixed(2) + " â‚¬";
                        document.getElementById('distDisplay').innerText = distanceText + " â€¢ ~" + route.duration.text;
                        document.getElementById('sendBtn').disabled = false;
                    } else {
                        console.log("Route Error:", status);
                    }
                });
            }
        }

        function calculateComplexPrice(km) {
            if (km <= 1) return 3.00;
            let price = 3.00;
            let remaining = km - 1;
            if (remaining <= 3) { price += remaining * 0.50; return price; }
            price += 1.50; remaining -= 3;
            let rate = 0.60;
            while (remaining > 0) {
                let chunk = remaining >= 1 ? 1 : remaining;
                price += chunk * rate;
                remaining -= 1; rate += 0.10;
            }
            return price;
        }

        function sendOrder() {
            if(navigator.vibrate) navigator.vibrate(50);
            
            var phone = document.getElementById('phone').value;
            var startAddr = document.getElementById('start').value;
            var startName = document.getElementById('startName').value || "-";
            var startFloor = document.getElementById('startFloor').value || "-";
            var endAddr = document.getElementById('end').value;
            var endName = document.getElementById('endName').value || "-";
            var endFloor = document.getElementById('endFloor').value || "-";
            var endPhone = document.getElementById('endPhone').value || "-";
            var parcelType = document.getElementById('parcelType').value;
            var paymentMethod = document.getElementById('paymentMethod').value;
            var comments = document.getElementById('comments').value;
            var price = calculatedPrice.toFixed(2);

            var timeString = "âš¡ Î‘ÎœÎ•Î£Î‘";
            if (timeMode === 'later') {
                var scheduledVal = document.getElementById('scheduledTime').value;
                if (!scheduledVal) { alert("âš ï¸ Î•Ï€Î¹Î»Î­Î¾Ï„Îµ ÏÏÎ± ÏÎ±Î½Ï„ÎµÎ²Î¿Ï!"); return; }
                var d = new Date(scheduledVal);
                timeString = "ğŸ“… " + d.getDate() + "/" + (d.getMonth()+1) + " ÏƒÏ„Î¹Ï‚ " + d.getHours() + ":" + (d.getMinutes()<10?'0':'') + d.getMinutes();
            }

            if (!phone) { alert("âš ï¸ Î£Ï…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ Ï„Î¿ Ï„Î·Î»Î­Ï†Ï‰Î½ÏŒ ÏƒÎ±Ï‚!"); return; }
            if (price == 0) { alert("âš ï¸ Î Î±Ï„Î®ÏƒÏ„Îµ Ï€Î¬Î½Ï‰ ÏƒÏ„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· Î³Î¹Î± Î½Î± Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„ÎµÎ¯ Î· Ï„Î¹Î¼Î®!"); calcRoute(); return; }

            document.getElementById('sendBtn').disabled = true;
            document.getElementById('btnText').style.display = 'none';
            document.getElementById('loader').style.display = 'block';

            var startFull = startAddr + " (ğŸ”” " + startName + ", ğŸ¢ " + startFloor + ")";
            var endFull = endAddr + " (ğŸ”” " + endName + ", ğŸ¢ " + endFloor + ")";
            var fullComments = "Î©Î¡Î‘: " + timeString + " | Î¤Î·Î» Î Î±ÏÎ±Î»Î®Ï€Ï„Î·: " + endPhone + " | Î”Î­Î¼Î±: " + parcelType + " | Î Î»Î·ÏÏ‰Î¼Î®: " + paymentMethod + " | " + comments;

            // WhatsApp
            var waText = "*ÎÎ­Î± Î Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î± 2Fast!* ğŸš€\n" +
                         "â° *" + timeString + "*\n\n" +
                         "ğŸ“ *Î•Î½Ï„Î¿Î»Î­Î±Ï‚:* " + phone + "\n" +
                         "-----------------------------\n" +
                         "ğŸ“ *Î‘Î ÎŸ:* " + startAddr + "\n" +
                         "   â”” " + startName + " (" + startFloor + ")\n" +
                         "ğŸ *Î Î¡ÎŸÎ£:* " + endAddr + "\n" +
                         "   â”” " + endName + " (" + endFloor + ")\n" +
                         "   ğŸ“ " + endPhone + "\n" +
                         "-----------------------------\n" +
                         "ğŸ“¦ *Î”Î­Î¼Î±:* " + parcelType + "\n" +
                         "ğŸ’³ *Î Î»Î·ÏÏ‰Î¼Î®:* " + paymentMethod + "\n" +
                         "ğŸ’¬ " + comments + "\n" +
                         "ğŸ’° *ÎšÏŒÏƒÏ„Î¿Ï‚:* " + price + " â‚¬ (" + distanceText + ")";
            
            var waLink = "https://wa.me/" + MY_PHONE + "?text=" + encodeURIComponent(waText);
            
            // Shipday Send
            var orderData = {
                phone: phone,
                start: st