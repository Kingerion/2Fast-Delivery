<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2Fast Delivery (Smart Location)</title>
    
    <style>
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: #f4f4f4; }
        
        #map { height: 45vh; width: 100%; }

        .container { 
            padding: 20px; 
            background: white; 
            border-radius: 20px 20px 0 0; 
            position: relative; 
            top: -20px; 
            z-index: 999;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.1); 
        }

        h2 { margin-top: 0; color: #333; text-align: center; font-size: 20px; }
        .instructions { text-align: center; font-size: 13px; color: #666; margin-bottom: 15px; background: #fff3e0; padding: 8px; border-radius: 8px; border: 1px solid #ffe0b2; }
        
        .input-group { margin-bottom: 15px; }
        label { font-size: 13px; font-weight: bold; color: #333; margin-bottom: 5px; display: block; }
        
        input, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; background: #fff; }
        input:focus { border-color: #4285F4; outline: none; }
        
        textarea { resize: vertical; height: 70px; }
        
        .price-box { background: #e3f2fd; padding: 15px; border-radius: 10px; text-align: center; margin: 20px 0; border: 2px solid #4285F4; }
        .price-value { font-size: 28px; font-weight: bold; color: #1565c0; }
        .distance-info { font-size: 15px; color: #555; margin-top: 5px; font-weight: 500; }

        button#sendBtn { width: 100%; padding: 16px; background: #ff5722; color: white; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; transition: background 0.3s; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        button:disabled { background: #ccc; cursor: not-allowed; box-shadow: none; }
        
        .loader { display: none; border: 4px solid #f3f3f3; border-top: 4px solid #ff5722; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .pac-container { z-index: 10000 !important; border-radius: 0 0 8px 8px; margin-top: 2px; }
    </style>
</head>
<body>

    <div id="map"></div>

    <div class="container">
        <h2>Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î® Î”Î­Î¼Î±Ï„Î¿Ï‚</h2>
        <div class="instructions">
            ğŸ“ <strong>Tip:</strong> Î•Î½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î·Î½ Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î± Î³Î¹Î± Î½Î± Î²ÏÎ¯ÏƒÎºÎµÎ¹ Ï„Î¿Ï…Ï‚ ÎºÎ¿Î½Ï„Î¹Î½Î¿ÏÏ‚ Î´ÏÏŒÎ¼Î¿Ï…Ï‚ Ï€ÏÏÏ„Î±!
        </div>
        
        <div class="input-group">
            <label>Î¤Î¿ Ï„Î·Î»Î­Ï†Ï‰Î½ÏŒ ÏƒÎ±Ï‚</label>
            <input type="tel" id="phone" placeholder="Ï€.Ï‡. 6900000000" required>
        </div>
        
        <div class="input-group">
            <label>Î‘Ï€ÏŒ Î Î¿Ï; (Î Î±ÏÎ±Î»Î±Î²Î®)</label>
            <input type="text" id="start" placeholder="Î“ÏÎ¬ÏˆÎµ Î¿Î´ÏŒ ÎºÎ±Î¹ Î±ÏÎ¹Î¸Î¼ÏŒ..." autocomplete="off">
        </div>

        <div class="input-group">
            <label>Î Î¿Ï Î Î¬ÎµÎ¹; (Î Î±ÏÎ¬Î´Î¿ÏƒÎ·)</label>
            <input type="text" id="end" placeholder="Î“ÏÎ¬ÏˆÎµ Î¿Î´ÏŒ ÎºÎ±Î¹ Î±ÏÎ¹Î¸Î¼ÏŒ..." autocomplete="off">
        </div>

        <div class="input-group">
            <textarea id="comments" placeholder="Î£Ï‡ÏŒÎ»Î¹Î± (Ï€.Ï‡. ÎšÎ¿Ï…Î´Î¿ÏÎ½Î¹, ÎŒÏÎ¿Ï†Î¿Ï‚, ÎŒÎ½Î¿Î¼Î±)"></textarea>
        </div>

        <div class="price-box">
            <div style="font-size: 14px; color: #777;">Î•ÎºÏ„Î¹Î¼ÏÎ¼ÎµÎ½Î¿ ÎšÏŒÏƒÏ„Î¿Ï‚</div>
            <div class="price-value" id="priceDisplay">0.00 â‚¬</div>
            <div class="distance-info" id="distDisplay">-</div>
        </div>

        <button id="sendBtn" onclick="sendOrder()" disabled>
            <span id="btnText">Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î® Î Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±Ï‚</span>
            <div class="loader" id="loader"></div>
        </button>
    </div>

    <script>
        var map;
        var directionsService;
        var directionsRenderer;
        var startAutocomplete, endAutocomplete;
        var calculatedPrice = 0;
        var distanceText = "";
        
        const MY_PHONE = "306934021792"; 
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz_XXXXXXXXXXXX/exec"; 

        function initMap() {
            var defaultCenter = { lat: 37.9838, lng: 23.7275 }; // Default: Î‘Î¸Î®Î½Î±
            
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 13,
                center: defaultCenter,
                mapTypeControl: false,
                streetViewControl: false,
                fullscreenControl: false
            });

            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer();
            directionsRenderer.setMap(map);

            initAutocomplete();
            
            // --- Î‘Î¥Î¤ÎŸÎœÎ‘Î¤ÎŸÎ£ Î•ÎÎ¤ÎŸÎ Î™Î£ÎœÎŸÎ£ ---
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const pos = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                        };
                        map.setCenter(pos); // Î Î¬ÎµÎ¹ Ï„Î¿Î½ Ï‡Î¬ÏÏ„Î· ÏƒÏ„Î¿Î½ Ï‡ÏÎ®ÏƒÏ„Î·
                        
                        // "Î”Î­Î½Î¿Ï…Î¼Îµ" Ï„Î·Î½ Î±Î½Î±Î¶Î®Ï„Î·ÏƒÎ· Î¼Îµ Ï„Î¿Î½ Ï‡Î¬ÏÏ„Î·
                        // ÎˆÏ„ÏƒÎ¹, Î±Î½ Î¿ Ï‡Î¬ÏÏ„Î·Ï‚ ÎµÎ¯Î½Î±Î¹ Î˜ÎµÏƒÏƒÎ±Î»Î¿Î½Î¯ÎºÎ·, ÏˆÎ¬Ï‡Î½ÎµÎ¹ Ï€ÏÏÏ„Î± ÎµÎºÎµÎ¯!
                        startAutocomplete.bindTo("bounds", map);
                        endAutocomplete.bindTo("bounds", map);
                    },
                    () => {
                        // Î‘Î½ Î±ÏÎ½Î·Î¸ÎµÎ¯, Î´ÎµÎ½ Ï€ÎµÎ¹ÏÎ¬Î¶ÎµÎ¹, Î¼Î­Î½Î¿Ï…Î¼Îµ Î‘Î¸Î®Î½Î±
                        console.log("Geolocation blocked");
                    }
                );
            }
        }

        function initAutocomplete() {
            var options = {
                componentRestrictions: { country: "gr" }, // ÎœÏŒÎ½Î¿ Î•Î»Î»Î¬Î´Î±
                fields: ["formatted_address", "geometry", "name"],
                strictBounds: false, // Î•Î Î™Î¤Î¡Î•Î Î•Î™ Î¼Î±ÎºÏÎ¹Î½Î­Ï‚ Î±Î½Î±Î¶Î·Ï„Î®ÏƒÎµÎ¹Ï‚
            };

            var startInput = document.getElementById('start');
            var endInput = document.getElementById('end');

            startAutocomplete = new google.maps.places.Autocomplete(startInput, options);
            endAutocomplete = new google.maps.places.Autocomplete(endInput, options);
            
            // Î‘Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î®, Ï„Î± "Î´Î­Î½Î¿Ï…Î¼Îµ" Î¼Îµ Ï„Î¿Î½ Ï‡Î¬ÏÏ„Î·
            startAutocomplete.bindTo('bounds', map);
            endAutocomplete.bindTo('bounds', map);

            startAutocomplete.addListener("place_changed", calcRoute);
            endAutocomplete.addListener("place_changed", calcRoute);
        }

        function calcRoute() {
            var startPlace = startAutocomplete.getPlace();
            var endPlace = endAutocomplete.getPlace();
            var startVal = document.getElementById('start').value;
            var endVal = document.getElementById('end').value;

            if (startVal && endVal) {
                var request = {
                    origin: startVal,
                    destination: endVal,
                    travelMode: 'DRIVING',
                    drivingOptions: {
                        departureTime: new Date(Date.now()),
                        trafficModel: 'bestguess'
                    }
                };

                directionsService.route(request, function(result, status) {
                    if (status == 'OK') {
                        directionsRenderer.setDirections(result);
                        var route = result.routes[0].legs[0];
                        var distMeters = route.distance.value;
                        var distKm = distMeters / 1000;
                        distanceText = route.distance.text;

                        calculatedPrice = calculateComplexPrice(distKm);

                        document.getElementById('priceDisplay').innerText = calculatedPrice.toFixed(2) + " â‚¬";
                        document.getElementById('distDisplay').innerText = distanceText + " â€¢ ~" + route.duration.text;
                        document.getElementById('sendBtn').disabled = false;
                    }
                });
            }
        }

        function calculateComplexPrice(km) {
            if (km <= 1) return 3.00;
            let price = 3.00;
            let remaining = km - 1;
            if (remaining <= 3) { price += remaining * 0.50; return price; }
            price += 1.50; remaining -= 3;
            let rate = 0.60;
            while (remaining > 0) {
                let chunk = remaining >= 1 ? 1 : remaining;
                price += chunk * rate;
                remaining -= 1; rate += 0.10;
            }
            return price;
        }

        function sendOrder() {
            var phone = document.getElementById('phone').value;
            var start = document.getElementById('start').value;
            var end = document.getElementById('end').value;
            var comments = document.getElementById('comments').value;
            var price = calculatedPrice.toFixed(2);

            if (!phone) { alert("âš ï¸ Î Î±ÏÎ±ÎºÎ±Î»Ï ÏƒÏ…Î¼Ï€Î»Î·ÏÏÏƒÏ„Îµ Ï„Î·Î»Î­Ï†Ï‰Î½Î¿!"); return; }
            if (price == 0) { alert("âš ï¸ Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ Î±Ï€ÏŒ Ï„Î· Î»Î¯ÏƒÏ„Î±!"); return; }

            document.getElementById('sendBtn').disabled = true;
            document.getElementById('btnText').innerText = "Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î®...";
            document.getElementById('loader').style.display = 'block';

            var waText = "*ÎÎ­Î± Î Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î±!* ğŸ“¦\n" +
                         "ğŸ“ Î¤Î·Î»: " + phone + "\n" +
                         "ğŸ“ Î‘Ï€ÏŒ: " + start + "\n" +
                         "ğŸ Î ÏÎ¿Ï‚: " + end + "\n" +
                         "ğŸ’¬ Î£Ï‡ÏŒÎ»Î¹Î±: " + comments + "\n" +
                         "ğŸ’° ÎšÏŒÏƒÏ„Î¿Ï‚: " + price + " â‚¬ (" + distanceText + ")";
            
            var waLink = "https://wa.me/" + MY_PHONE + "?text=" + encodeURIComponent(waText);
            window.open(waLink, '_blank');

            var orderData = {
                phone: phone,
                start: start,
                end: end,
                comments: comments,
                price: price,
                dist: distanceText
            };

            fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(orderData)
            }).then(() => {
                setTimeout(function(){
                    alert("âœ… Î— Ï€Î±ÏÎ±Î³Î³ÎµÎ»Î¯Î± ÎµÏƒÏ„Î¬Î»Î·!");
                    location.reload();
                }, 1000);
            }).catch(error => {
                alert("Î£Ï†Î¬Î»Î¼Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚: " + error);
                location.reload();
            });
        }
    </script>
    
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBkk3z2W3H172JxqlF4G0FjwppTDHJeXiw&libraries=places&callback=initMap" async defer></script>

</body>
</html>
